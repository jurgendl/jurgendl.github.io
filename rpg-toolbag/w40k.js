!function(){"use strict";function e(e){return e<26?e+65:e<52?e+71:e<62?e-4:62===e?43:63===e?47:65}const t=4294967296,s=[4294967295,-t],i=[0,-0x8000000000000000],n=[0,0],r=[1,0];function a(e,t){return d(e[0]+t[0],e[1]+t[1])}function o(e){var t=[];return t[e-1]=void 0,t}function c(e,s){return i=~~Math.max(Math.min(e[1]/t,2147483647),-2147483648)&~~Math.max(Math.min(s[1]/t,2147483647),-2147483648),n=p(e)&p(s),r=n,n<0&&(r+=t),[r,i*t];var i,n,r}function l(e,t){var s,i;return e[0]==t[0]&&e[1]==t[1]?0:(s=e[1]<0,i=t[1]<0,s&&!i?-1:!s&&i?1:g(e,t)[1]<0?-1:1)}function d(e,s){var i,n;for(e%=0x10000000000000000,s=(s%=0x10000000000000000)-(i=s%t)+(n=Math.floor(e/t)*t),e=e-n+i;e<0;)e+=t,s-=t;for(;e>4294967295;)e-=t,s+=t;for(s%=0x10000000000000000;s>0x7fffffff00000000;)s-=0x10000000000000000;for(;s<-0x8000000000000000;)s+=0x10000000000000000;return[e,s]}function u(e,t){return e[0]==t[0]&&e[1]==t[1]}function h(e){return e>=0?[e,0]:[e+t,-t]}function p(e){return e[0]>=2147483648?~~Math.max(Math.min(e[0]-t,2147483647),-2147483648):~~Math.max(Math.min(e[0],2147483647),-2147483648)}function m(e){return e<=30?1<<e:m(30)*m(e-30)}function _(e,s){var r,a,o,c;if(s&=63,u(e,i))return s?n:e;if(e[1]<0)throw new Error("Neg");return c=m(s),a=e[1]*c%0x10000000000000000,(a+=r=(o=e[0]*c)-o%t)>=0x8000000000000000&&(a-=0x10000000000000000),[o-=r,a]}function f(e,t){var s;return s=m(t&=63),d(Math.floor(e[0]/s),e[1]/s)}function g(e,t){return d(e[0]-t[0],e[1]-t[1])}function P(e,t){return e.buf=t,e.pos=0,e.count=t.length,e}function k(e){return e.pos>=e.count?-1:255&e.buf[e.pos++]}function v(e,t,s,i){return e.pos>=e.count?-1:(i=Math.min(i,e.count-e.pos),C(e.buf,e.pos,t,s,i),e.pos+=i,i)}function b(e){return e.buf=o(32),e.count=0,e}function E(e){var t=e.buf;return t.length=e.count,t}function S(e,t){e.buf[e.count++]=t<<24>>24}function B(e,t,s,i){C(t,s,e.buf,e.count,i),e.count+=i}function C(e,t,s,i,n){for(var r=0;r<n;++r)s[i+r]=e[t+r]}function w(e,t){return e._bufferBase[e._bufferOffset+e._pos+t]}function T(e,t,s,i){var n,r;for(e._streamEndWasReached&&e._pos+t+i>e._streamPos&&(i=e._streamPos-(e._pos+t)),++s,r=e._bufferOffset+e._pos+t,n=0;n<i&&e._bufferBase[r+n]==e._bufferBase[r+n-s];++n);return n}function y(e){return e._streamPos-e._pos}function x(e){var t,s;if(!e._streamEndWasReached)for(;;){if(!(s=-e._bufferOffset+e._blockSize-e._streamPos))return;if(-1==(t=v(e._stream,e._bufferBase,e._bufferOffset+e._streamPos,s)))return e._posLimit=e._streamPos,e._bufferOffset+e._posLimit>e._pointerToLastSafePosition&&(e._posLimit=e._pointerToLastSafePosition-e._bufferOffset),void(e._streamEndWasReached=1);e._streamPos+=t,e._streamPos>=e._pos+e._keepSizeAfter&&(e._posLimit=e._streamPos-e._keepSizeAfter)}}function L(e,t){e._bufferOffset+=t,e._posLimit-=t,e._pos-=t,e._streamPos-=t}var M=function(){var e,t,s,i=[];for(e=0;e<256;++e){for(s=e,t=0;t<8;++t)0!=(1&s)?s=s>>>1^-306674912:s>>>=1;i[e]=s}return i}();function D(e){var t;++e._cyclicBufferPos>=e._cyclicBufferSize&&(e._cyclicBufferPos=0),function(e){++e._pos,e._pos>e._posLimit&&(e._bufferOffset+e._pos>e._pointerToLastSafePosition&&function(e){var t,s,i;for((i=e._bufferOffset+e._pos-e._keepSizeBefore)>0&&--i,s=e._bufferOffset+e._streamPos-i,t=0;t<s;++t)e._bufferBase[t]=e._bufferBase[i+t];e._bufferOffset-=i}(e),x(e))}(e),1073741823==e._pos&&(t=e._pos-e._cyclicBufferSize,A(e._son,2*e._cyclicBufferSize,t),A(e._hash,e._hashSizeSum,t),L(e,t))}function A(e,t,s){var i,n;for(i=0;i<t;++i)(n=e[i]||0)<=s?n=0:n-=s,e[i]=n}function R(e){var t=e._pos-e._streamPos;t&&(B(e._stream,e._buffer,e._streamPos,t),e._pos>=e._windowSize&&(e._pos=0),e._streamPos=e._pos)}function I(e,t){var s=e._pos-t-1;return s<0&&(s+=e._windowSize),e._buffer[s]}function F(e){R(e),e._stream=null}function q(e){return(e-=2)<4?e:3}function z(e){return e<4?0:e<10?e-3:e-6}function H(e){if(!e.alive)throw new Error("bad state");return e.encoder?function(e){(function(e,t,s,i){var o,c,d,m,_,f,P,k,v,b,E,S,B,C,T;if(t[0]=n,s[0]=n,i[0]=1,e._inStream&&(e._matchFinder._stream=e._inStream,function(e){e._bufferOffset=0,e._pos=0,e._streamPos=0,e._streamEndWasReached=0,x(e),e._cyclicBufferPos=0,L(e,-1)}(e._matchFinder),e._needReleaseMFStream=1,e._inStream=null),!e._finished){if(e._finished=1,C=e.nowPos64,u(e.nowPos64,n)){if(!y(e._matchFinder))return void V(e,p(e.nowPos64));te(e),B=p(e.nowPos64)&e._posStateMask,ye(e._rangeEncoder,e._isMatch,(e._state<<4)+B,0),e._state=z(e._state),d=w(e._matchFinder,-e._additionalOffset),ue(de(e._literalEncoder,p(e.nowPos64),e._previousByte),e._rangeEncoder,d),e._previousByte=d,--e._additionalOffset,e.nowPos64=a(e.nowPos64,r)}if(y(e._matchFinder))for(;;){if(P=K(e,p(e.nowPos64)),b=e.backRes,B=p(e.nowPos64)&e._posStateMask,c=(e._state<<4)+B,1==P&&-1==b)ye(e._rangeEncoder,e._isMatch,c,0),d=w(e._matchFinder,-e._additionalOffset),T=de(e._literalEncoder,p(e.nowPos64),e._previousByte),e._state<7?ue(T,e._rangeEncoder,d):(v=w(e._matchFinder,-e._repDistances[0]-1-e._additionalOffset),he(T,e._rangeEncoder,v,d)),e._previousByte=d,e._state=z(e._state);else{if(ye(e._rangeEncoder,e._isMatch,c,1),b<4){if(ye(e._rangeEncoder,e._isRep,e._state,1),b?(ye(e._rangeEncoder,e._isRepG0,e._state,1),1==b?ye(e._rangeEncoder,e._isRepG1,e._state,0):(ye(e._rangeEncoder,e._isRepG1,e._state,1),ye(e._rangeEncoder,e._isRepG2,e._state,b-2))):(ye(e._rangeEncoder,e._isRepG0,e._state,0),ye(e._rangeEncoder,e._isRep0Long,c,1==P?0:1)),1==P?e._state=e._state<7?9:11:(ae(e._repMatchLenEncoder,e._rangeEncoder,P-2,B),e._state=e._state<7?8:11),m=e._repDistances[b],0!=b){for(f=b;f>=1;--f)e._repDistances[f]=e._repDistances[f-1];e._repDistances[0]=m}}else{for(ye(e._rangeEncoder,e._isRep,e._state,0),e._state=e._state<7?7:10,ae(e._lenEncoder,e._rangeEncoder,P-2,B),S=ie(b-=4),k=q(P),ke(e._posSlotEncoder[k],e._rangeEncoder,S),S>=4&&(E=b-(o=(2|1&S)<<(_=(S>>1)-1)),S<14?Se(e._posEncoders,o-S-1,e._rangeEncoder,_,E):(xe(e._rangeEncoder,E>>4,_-4),be(e._posAlignEncoder,e._rangeEncoder,15&E),++e._alignPriceCount)),m=b,f=3;f>=1;--f)e._repDistances[f]=e._repDistances[f-1];e._repDistances[0]=m,++e._matchPriceCount}e._previousByte=w(e._matchFinder,P-1-e._additionalOffset)}if(e._additionalOffset-=P,e.nowPos64=a(e.nowPos64,h(P)),!e._additionalOffset){if(e._matchPriceCount>=128&&J(e),e._alignPriceCount>=16&&Z(e),t[0]=e.nowPos64,s[0]=Le(e._rangeEncoder),!y(e._matchFinder))return void V(e,p(e.nowPos64));if(l(g(e.nowPos64,C),[4096,0])>=0)return e._finished=0,void(i[0]=0)}}else V(e,p(e.nowPos64))}})(e.encoder,e.encoder.processedInSize,e.encoder.processedOutSize,e.encoder.finished),e.inBytesProcessed=e.encoder.processedInSize[0],e.encoder.finished[0]&&(function(e){se(e),e._rangeEncoder.Stream=null}(e.encoder),e.alive=0)}(e):function(e){var t=function(e){var t,s,i,n,o,c;if(c=p(e.nowPos64)&e.m_PosStateMask,Ce(e.m_RangeDecoder,e.m_IsMatchDecoders,(e.state<<4)+c)){if(Ce(e.m_RangeDecoder,e.m_IsRepDecoders,e.state))i=0,Ce(e.m_RangeDecoder,e.m_IsRepG0Decoders,e.state)?(Ce(e.m_RangeDecoder,e.m_IsRepG1Decoders,e.state)?(Ce(e.m_RangeDecoder,e.m_IsRepG2Decoders,e.state)?(s=e.rep3,e.rep3=e.rep2):s=e.rep2,e.rep2=e.rep1):s=e.rep1,e.rep1=e.rep0,e.rep0=s):Ce(e.m_RangeDecoder,e.m_IsRep0LongDecoders,(e.state<<4)+c)||(e.state=e.state<7?9:11,i=1),i||(i=O(e.m_RepLenDecoder,e.m_RangeDecoder,c)+2,e.state=e.state<7?8:11);else if(e.rep3=e.rep2,e.rep2=e.rep1,e.rep1=e.rep0,i=2+O(e.m_LenDecoder,e.m_RangeDecoder,c),e.state=e.state<7?7:10,(o=ge(e.m_PosSlotDecoder[q(i)],e.m_RangeDecoder))>=4){if(n=(o>>1)-1,e.rep0=(2|1&o)<<n,o<14)e.rep0+=function(e,t,s,i){var n,r,a=1,o=0;for(r=0;r<i;++r)n=Ce(s,e,t+a),a<<=1,a+=n,o|=n<<r;return o}(e.m_PosDecoders,e.rep0-o-1,e.m_RangeDecoder,n);else if(e.rep0+=function(e,t){var s,i,n=0;for(s=t;0!=s;--s)e.Range>>>=1,i=e.Code-e.Range>>>31,e.Code-=e.Range&i-1,n=n<<1|1-i,-16777216&e.Range||(e.Code=e.Code<<8|k(e.Stream),e.Range<<=8);return n}(e.m_RangeDecoder,n-4)<<4,e.rep0+=function(e,t){var s,i,n=1,r=0;for(i=0;i<e.NumBitLevels;++i)s=Ce(t,e.Models,n),n<<=1,n+=s,r|=s<<i;return r}(e.m_PosAlignDecoder,e.m_RangeDecoder),e.rep0<0)return-1==e.rep0?1:-1}else e.rep0=o;if(l(h(e.rep0),e.nowPos64)>=0||e.rep0>=e.m_DictionarySizeCheck)return-1;!function(e,t,s){var i=e._pos-t-1;for(i<0&&(i+=e._windowSize);0!=s;--s)i>=e._windowSize&&(i=0),e._buffer[e._pos++]=e._buffer[i++],e._pos>=e._windowSize&&R(e)}(e.m_OutWindow,e.rep0,i),e.nowPos64=a(e.nowPos64,h(i)),e.prevByte=I(e.m_OutWindow,0)}else t=function(e,t,s){return e.m_Coders[((t&e.m_PosMask)<<e.m_NumPrevBits)+((255&s)>>>8-e.m_NumPrevBits)]}(e.m_LiteralDecoder,p(e.nowPos64),e.prevByte),e.state<7?e.prevByte=function(e,t){var s=1;do{s=s<<1|Ce(t,e.m_Decoders,s)}while(s<256);return s<<24>>24}(t,e.m_RangeDecoder):e.prevByte=function(e,t,s){var i,n,r=1;do{if(n=s>>7&1,s<<=1,r=r<<1|(i=Ce(t,e.m_Decoders,(1+n<<8)+r)),n!=i){for(;r<256;)r=r<<1|Ce(t,e.m_Decoders,r);break}}while(r<256);return r<<24>>24}(t,e.m_RangeDecoder,I(e.m_OutWindow,e.rep0)),function(e,t){e._buffer[e._pos++]=t,e._pos>=e._windowSize&&R(e)}(e.m_OutWindow,e.prevByte),e.state=z(e.state),e.nowPos64=a(e.nowPos64,r);return 0}(e.decoder);if(-1==t)throw new Error("corrupted input");e.inBytesProcessed=s,e.outBytesProcessed=e.decoder.nowPos64,(t||l(e.decoder.outSize,n)>=0&&l(e.decoder.nowPos64,e.decoder.outSize)>=0)&&(R(e.decoder.m_OutWindow),F(e.decoder.m_OutWindow),e.decoder.m_RangeDecoder.Stream=null,e.alive=0)}(e),e.alive}function W(e,t){for(;e.m_NumPosStates<t;++e.m_NumPosStates)e.m_LowCoder[e.m_NumPosStates]=fe({},3),e.m_MidCoder[e.m_NumPosStates]=fe({},3)}function O(e,t,s){if(!Ce(t,e.m_Choice,0))return ge(e.m_LowCoder[s],t);var i=8;return Ce(t,e.m_Choice,1)?i+=8+ge(e.m_HighCoder,t):i+=ge(e.m_MidCoder[s],t),i}function N(e){return e.m_Choice=o(2),e.m_LowCoder=o(16),e.m_MidCoder=o(16),e.m_HighCoder=fe({},8),e.m_NumPosStates=0,e}function G(e){we(e.m_Choice);for(var t=0;t<e.m_NumPosStates;++t)we(e.m_LowCoder[t].Models),we(e.m_MidCoder[t].Models);we(e.m_HighCoder.Models)}function j(e){return e.m_Decoders=o(768),e}var Y=function(){var e,t,s,i=2,n=[0,1];for(s=2;s<22;++s)for(t=1<<(s>>1)-1,e=0;e<t;++e,++i)n[i]=s<<24>>24;return n}();function U(e,t){var s,i,n,r;e._optimumEndIndex=t,n=e._optimum[t].PosPrev,i=e._optimum[t].BackPrev;do{e._optimum[t].Prev1IsChar&&(_e(e._optimum[n]),e._optimum[n].PosPrev=n-1,e._optimum[t].Prev2&&(e._optimum[n-1].Prev1IsChar=0,e._optimum[n-1].PosPrev=e._optimum[t].PosPrev2,e._optimum[n-1].BackPrev=e._optimum[t].BackPrev2)),r=n,s=i,i=e._optimum[r].BackPrev,n=e._optimum[r].PosPrev,e._optimum[r].BackPrev=s,e._optimum[r].PosPrev=t,t=r}while(t>0);return e.backRes=e._optimum[0].BackPrev,e._optimumCurrentIndex=e._optimum[0].PosPrev,e._optimumCurrentIndex}function Z(e){for(var t=0;t<16;++t)e._alignPrices[t]=Ee(e._posAlignEncoder,t);e._alignPriceCount=0}function J(e){var t,s,i,n,r,a,o,c;for(n=4;n<128;++n)t=(2|1&(a=ie(n)))<<(i=(a>>1)-1),e.tempPrices[n]=Be(e._posEncoders,t-a-1,i,n-t);for(r=0;r<4;++r){for(s=e._posSlotEncoder[r],o=r<<6,a=0;a<e._distTableSize;++a)e._posSlotPrices[o+a]=ve(s,a);for(a=14;a<e._distTableSize;++a)e._posSlotPrices[o+a]+=(a>>1)-1-4<<6;for(c=128*r,n=0;n<4;++n)e._distancesPrices[c+n]=e._posSlotPrices[o+n];for(;n<128;++n)e._distancesPrices[c+n]=e._posSlotPrices[o+ie(n)]+e.tempPrices[n]}e._matchPriceCount=0}function V(e,t){se(e),function(e,t){if(e._writeEndMark){ye(e._rangeEncoder,e._isMatch,(e._state<<4)+t,1),ye(e._rangeEncoder,e._isRep,e._state,0),e._state=e._state<7?7:10,ae(e._lenEncoder,e._rangeEncoder,0,t);var s=q(2);ke(e._posSlotEncoder[s],e._rangeEncoder,63),xe(e._rangeEncoder,67108863,26),be(e._posAlignEncoder,e._rangeEncoder,15)}}(e,t&e._posStateMask);for(var s=0;s<5;++s)Me(e._rangeEncoder)}function K(e,t){var s,i,n,r,a,o,c,l,d,u,h,p,m,_,f,g,P,k,v,b,E,S,B,C,x,L,M,D,A,R,I,F,q,H,W,O,N,$,G,j,Y,Z,J,V;if(e._optimumEndIndex!=e._optimumCurrentIndex)return m=e._optimum[e._optimumCurrentIndex].PosPrev-e._optimumCurrentIndex,e.backRes=e._optimum[e._optimumCurrentIndex].BackPrev,e._optimumCurrentIndex=e._optimum[e._optimumCurrentIndex].PosPrev,m;if(e._optimumCurrentIndex=e._optimumEndIndex=0,e._longestMatchWasFound?(p=e._longestMatchLength,e._longestMatchWasFound=0):p=te(e),L=e._numDistancePairs,(C=y(e._matchFinder)+1)<2)return e.backRes=-1,1;for(C>273&&(C=273),G=0,d=0;d<4;++d)e.reps[d]=e._repDistances[d],e.repLens[d]=T(e._matchFinder,-1,e.reps[d],273),e.repLens[d]>e.repLens[G]&&(G=d);if(e.repLens[G]>=e._numFastBytes)return e.backRes=G,ee(e,(m=e.repLens[G])-1),m;if(p>=e._numFastBytes)return e.backRes=e._matchDistances[L-1]+4,ee(e,p-1),p;if(c=w(e._matchFinder,-1),P=w(e._matchFinder,-e._repDistances[0]-1-1),p<2&&c!=P&&e.repLens[G]<2)return e.backRes=-1,1;if(e._optimum[0].State=e._state,q=t&e._posStateMask,e._optimum[1].Price=Te[e._isMatch[(e._state<<4)+q]>>>2]+me(de(e._literalEncoder,t,e._previousByte),e._state>=7,P,c),_e(e._optimum[1]),$=(k=Te[2048-e._isMatch[(e._state<<4)+q]>>>2])+Te[2048-e._isRep[e._state]>>>2],P==c&&(j=$+function(e,t,s){return Te[e._isRepG0[t]>>>2]+Te[e._isRep0Long[(t<<4)+s]>>>2]}(e,e._state,q),j<e._optimum[1].Price&&(e._optimum[1].Price=j,function(e){e.BackPrev=0,e.Prev1IsChar=0}(e._optimum[1]))),(h=p>=e.repLens[G]?p:e.repLens[G])<2)return e.backRes=e._optimum[1].BackPrev,1;e._optimum[1].PosPrev=0,e._optimum[0].Backs0=e.reps[0],e._optimum[0].Backs1=e.reps[1],e._optimum[0].Backs2=e.reps[2],e._optimum[0].Backs3=e.reps[3],u=h;do{e._optimum[u--].Price=268435455}while(u>=2);for(d=0;d<4;++d)if(!((N=e.repLens[d])<2)){W=$+X(e,d,e._state,q);do{(r=W+ce(e._repMatchLenEncoder,N-2,q))<(R=e._optimum[N]).Price&&(R.Price=r,R.PosPrev=0,R.BackPrev=d,R.Prev1IsChar=0)}while(--N>=2)}if(B=k+Te[e._isRep[e._state]>>>2],(u=e.repLens[0]>=2?e.repLens[0]+1:2)<=p){for(M=0;u>e._matchDistances[M];)M+=2;for(;(r=B+Q(e,l=e._matchDistances[M+1],u,q))<(R=e._optimum[u]).Price&&(R.Price=r,R.PosPrev=0,R.BackPrev=l+4,R.Prev1IsChar=0),u!=e._matchDistances[M]||(M+=2)!=L;++u);}for(s=0;;){if(++s==h)return U(e,s);if(v=te(e),L=e._numDistancePairs,v>=e._numFastBytes)return e._longestMatchLength=v,e._longestMatchWasFound=1,U(e,s);if(++t,F=e._optimum[s].PosPrev,e._optimum[s].Prev1IsChar?(--F,e._optimum[s].Prev2?(Z=e._optimum[e._optimum[s].PosPrev2].State,Z=e._optimum[s].BackPrev2<4?Z<7?8:11:Z<7?7:10):Z=e._optimum[F].State,Z=z(Z)):Z=e._optimum[F].State,F==s-1?Z=e._optimum[s].BackPrev?z(Z):Z<7?9:11:(e._optimum[s].Prev1IsChar&&e._optimum[s].Prev2?(F=e._optimum[s].PosPrev2,I=e._optimum[s].BackPrev2,Z=Z<7?8:11):Z=(I=e._optimum[s].BackPrev)<4?Z<7?8:11:Z<7?7:10,A=e._optimum[F],I<4?I?1==I?(e.reps[0]=A.Backs1,e.reps[1]=A.Backs0,e.reps[2]=A.Backs2,e.reps[3]=A.Backs3):2==I?(e.reps[0]=A.Backs2,e.reps[1]=A.Backs0,e.reps[2]=A.Backs1,e.reps[3]=A.Backs3):(e.reps[0]=A.Backs3,e.reps[1]=A.Backs0,e.reps[2]=A.Backs1,e.reps[3]=A.Backs2):(e.reps[0]=A.Backs0,e.reps[1]=A.Backs1,e.reps[2]=A.Backs2,e.reps[3]=A.Backs3):(e.reps[0]=I-4,e.reps[1]=A.Backs0,e.reps[2]=A.Backs1,e.reps[3]=A.Backs2)),e._optimum[s].State=Z,e._optimum[s].Backs0=e.reps[0],e._optimum[s].Backs1=e.reps[1],e._optimum[s].Backs2=e.reps[2],e._optimum[s].Backs3=e.reps[3],o=e._optimum[s].Price,c=w(e._matchFinder,-1),P=w(e._matchFinder,-e.reps[0]-1-1),q=t&e._posStateMask,b=0,(i=o+Te[e._isMatch[(Z<<4)+q]>>>2]+me(de(e._literalEncoder,t,w(e._matchFinder,-2)),Z>=7,P,c))<(E=e._optimum[s+1]).Price&&(E.Price=i,E.PosPrev=s,E.BackPrev=-1,E.Prev1IsChar=0,b=1),$=(k=o+Te[2048-e._isMatch[(Z<<4)+q]>>>2])+Te[2048-e._isRep[Z]>>>2],P!=c||E.PosPrev<s&&!E.BackPrev||(j=$+(Te[e._isRepG0[Z]>>>2]+Te[e._isRep0Long[(Z<<4)+q]>>>2]))<=E.Price&&(E.Price=j,E.PosPrev=s,E.BackPrev=0,E.Prev1IsChar=0,b=1),!((C=x=4095-s<(x=y(e._matchFinder)+1)?4095-s:x)<2)){if(C>e._numFastBytes&&(C=e._numFastBytes),!b&&P!=c&&(V=Math.min(x-1,e._numFastBytes),(f=T(e._matchFinder,0,e.reps[0],V))>=2)){for(J=z(Z),H=t+1&e._posStateMask,S=i+Te[2048-e._isMatch[(J<<4)+H]>>>2]+Te[2048-e._isRep[J]>>>2],D=s+1+f;h<D;)e._optimum[++h].Price=268435455;(r=S+(ce(e._repMatchLenEncoder,f-2,H)+X(e,0,J,H)))<(R=e._optimum[D]).Price&&(R.Price=r,R.PosPrev=s+1,R.BackPrev=0,R.Prev1IsChar=1,R.Prev2=0)}for(Y=2,O=0;O<4;++O)if(!((_=T(e._matchFinder,-1,e.reps[O],C))<2)){g=_;do{for(;h<s+_;)e._optimum[++h].Price=268435455;(r=$+(ce(e._repMatchLenEncoder,_-2,q)+X(e,O,Z,q)))<(R=e._optimum[s+_]).Price&&(R.Price=r,R.PosPrev=s,R.BackPrev=O,R.Prev1IsChar=0)}while(--_>=2);if(_=g,O||(Y=_+1),_<x&&(V=Math.min(x-1-_,e._numFastBytes),(f=T(e._matchFinder,_,e.reps[O],V))>=2)){for(J=Z<7?8:11,H=t+_&e._posStateMask,n=$+(ce(e._repMatchLenEncoder,_-2,q)+X(e,O,Z,q))+Te[e._isMatch[(J<<4)+H]>>>2]+me(de(e._literalEncoder,t+_,w(e._matchFinder,_-1-1)),1,w(e._matchFinder,_-1-(e.reps[O]+1)),w(e._matchFinder,_-1)),J=z(J),H=t+_+1&e._posStateMask,S=n+Te[2048-e._isMatch[(J<<4)+H]>>>2]+Te[2048-e._isRep[J]>>>2],D=_+1+f;h<s+D;)e._optimum[++h].Price=268435455;(r=S+(ce(e._repMatchLenEncoder,f-2,H)+X(e,0,J,H)))<(R=e._optimum[s+D]).Price&&(R.Price=r,R.PosPrev=s+_+1,R.BackPrev=0,R.Prev1IsChar=1,R.Prev2=1,R.PosPrev2=s,R.BackPrev2=O)}}if(v>C){for(v=C,L=0;v>e._matchDistances[L];L+=2);e._matchDistances[L]=v,L+=2}if(v>=Y){for(B=k+Te[e._isRep[Z]>>>2];h<s+v;)e._optimum[++h].Price=268435455;for(M=0;Y>e._matchDistances[M];)M+=2;for(_=Y;;++_)if((r=B+Q(e,a=e._matchDistances[M+1],_,q))<(R=e._optimum[s+_]).Price&&(R.Price=r,R.PosPrev=s,R.BackPrev=a+4,R.Prev1IsChar=0),_==e._matchDistances[M]){if(_<x&&(V=Math.min(x-1-_,e._numFastBytes),(f=T(e._matchFinder,_,a,V))>=2)){for(J=Z<7?7:10,H=t+_&e._posStateMask,n=r+Te[e._isMatch[(J<<4)+H]>>>2]+me(de(e._literalEncoder,t+_,w(e._matchFinder,_-1-1)),1,w(e._matchFinder,_-(a+1)-1),w(e._matchFinder,_-1)),J=z(J),H=t+_+1&e._posStateMask,S=n+Te[2048-e._isMatch[(J<<4)+H]>>>2]+Te[2048-e._isRep[J]>>>2],D=_+1+f;h<s+D;)e._optimum[++h].Price=268435455;(r=S+(ce(e._repMatchLenEncoder,f-2,H)+X(e,0,J,H)))<(R=e._optimum[s+D]).Price&&(R.Price=r,R.PosPrev=s+_+1,R.BackPrev=0,R.Prev1IsChar=1,R.Prev2=1,R.PosPrev2=s,R.BackPrev2=a+4)}if((M+=2)==L)break}}}}}function Q(e,t,s,i){var n=q(s);return(t<128?e._distancesPrices[128*n+t]:e._posSlotPrices[(n<<6)+function(e){return e<131072?Y[e>>6]+12:e<134217728?Y[e>>16]+32:Y[e>>26]+52}(t)]+e._alignPrices[15&t])+ce(e._lenEncoder,s-2,i)}function X(e,t,s,i){var n;return t?(n=Te[2048-e._isRepG0[s]>>>2],1==t?n+=Te[e._isRepG1[s]>>>2]:(n+=Te[2048-e._isRepG1[s]>>>2],n+=De(e._isRepG2[s],t-2))):(n=Te[e._isRepG0[s]>>>2],n+=Te[2048-e._isRep0Long[(s<<4)+i]>>>2]),n}function ee(e,t){t>0&&(function(e,t){var s,i,n,r,a,o,c,l,d,u,h,p,m,_,f,g,P;do{if(e._pos+e._matchMaxLen<=e._streamPos)p=e._matchMaxLen;else if((p=e._streamPos-e._pos)<e.kMinMatchCheck){D(e);continue}for(m=e._pos>e._cyclicBufferSize?e._pos-e._cyclicBufferSize:0,i=e._bufferOffset+e._pos,e.HASH_ARRAY?(o=1023&(P=M[255&e._bufferBase[i]]^255&e._bufferBase[i+1]),e._hash[o]=e._pos,c=65535&(P^=(255&e._bufferBase[i+2])<<8),e._hash[1024+c]=e._pos,l=(P^M[255&e._bufferBase[i+3]]<<5)&e._hashMask):l=255&e._bufferBase[i]^(255&e._bufferBase[i+1])<<8,n=e._hash[e.kFixHashSize+l],e._hash[e.kFixHashSize+l]=e._pos,f=1+(e._cyclicBufferPos<<1),g=e._cyclicBufferPos<<1,u=h=e.kNumHashDirectBytes,s=e._cutValue;;){if(n<=m||0==s--){e._son[f]=e._son[g]=0;break}if(r=((a=e._pos-n)<=e._cyclicBufferPos?e._cyclicBufferPos-a:e._cyclicBufferPos-a+e._cyclicBufferSize)<<1,_=e._bufferOffset+n,d=u<h?u:h,e._bufferBase[_+d]==e._bufferBase[i+d]){for(;++d!=p&&e._bufferBase[_+d]==e._bufferBase[i+d];);if(d==p){e._son[g]=e._son[r],e._son[f]=e._son[r+1];break}}(255&e._bufferBase[_+d])<(255&e._bufferBase[i+d])?(e._son[g]=n,g=r+1,n=e._son[g],h=d):(e._son[f]=n,f=r,n=e._son[f],u=d)}D(e)}while(0!=--t)}(e._matchFinder,t),e._additionalOffset+=t)}function te(e){var t=0;return e._numDistancePairs=function(e,t){var s,i,n,r,a,o,c,l,d,u,h,p,m,_,f,g,P,k,v,b,E;if(e._pos+e._matchMaxLen<=e._streamPos)_=e._matchMaxLen;else if((_=e._streamPos-e._pos)<e.kMinMatchCheck)return D(e),0;for(P=0,f=e._pos>e._cyclicBufferSize?e._pos-e._cyclicBufferSize:0,i=e._bufferOffset+e._pos,g=1,l=0,d=0,e.HASH_ARRAY?(l=1023&(E=M[255&e._bufferBase[i]]^255&e._bufferBase[i+1]),d=65535&(E^=(255&e._bufferBase[i+2])<<8),u=(E^M[255&e._bufferBase[i+3]]<<5)&e._hashMask):u=255&e._bufferBase[i]^(255&e._bufferBase[i+1])<<8,n=e._hash[e.kFixHashSize+u]||0,e.HASH_ARRAY&&(r=e._hash[l]||0,a=e._hash[1024+d]||0,e._hash[l]=e._pos,e._hash[1024+d]=e._pos,r>f&&e._bufferBase[e._bufferOffset+r]==e._bufferBase[i]&&(t[P++]=g=2,t[P++]=e._pos-r-1),a>f&&e._bufferBase[e._bufferOffset+a]==e._bufferBase[i]&&(a==r&&(P-=2),t[P++]=g=3,t[P++]=e._pos-a-1,r=a),0!=P&&r==n&&(P-=2,g=1)),e._hash[e.kFixHashSize+u]=e._pos,v=1+(e._cyclicBufferPos<<1),b=e._cyclicBufferPos<<1,p=m=e.kNumHashDirectBytes,0!=e.kNumHashDirectBytes&&n>f&&e._bufferBase[e._bufferOffset+n+e.kNumHashDirectBytes]!=e._bufferBase[i+e.kNumHashDirectBytes]&&(t[P++]=g=e.kNumHashDirectBytes,t[P++]=e._pos-n-1),s=e._cutValue;;){if(n<=f||0==s--){e._son[v]=e._son[b]=0;break}if(o=((c=e._pos-n)<=e._cyclicBufferPos?e._cyclicBufferPos-c:e._cyclicBufferPos-c+e._cyclicBufferSize)<<1,k=e._bufferOffset+n,h=p<m?p:m,e._bufferBase[k+h]==e._bufferBase[i+h]){for(;++h!=_&&e._bufferBase[k+h]==e._bufferBase[i+h];);if(g<h&&(t[P++]=g=h,t[P++]=c-1,h==_)){e._son[b]=e._son[o],e._son[v]=e._son[o+1];break}}(255&e._bufferBase[k+h])<(255&e._bufferBase[i+h])?(e._son[b]=n,b=o+1,n=e._son[b],m=h):(e._son[v]=n,v=o,n=e._son[v],p=h)}return D(e),P}(e._matchFinder,e._matchDistances),e._numDistancePairs>0&&(t=e._matchDistances[e._numDistancePairs-2])==e._numFastBytes&&(t+=T(e._matchFinder,t-1,e._matchDistances[e._numDistancePairs-1],273-t)),++e._additionalOffset,t}function se(e){e._matchFinder&&e._needReleaseMFStream&&(e._matchFinder._stream=null,e._needReleaseMFStream=0)}function ie(e){return e<2048?Y[e]:e<2097152?Y[e>>10]+20:Y[e>>20]+40}function ne(e,t){we(e._choice);for(var s=0;s<t;++s)we(e._lowCoder[s].Models),we(e._midCoder[s].Models);we(e._highCoder.Models)}function re(e,t,s,i,n){var r,a,o,c,l;for(r=Te[e._choice[0]>>>2],o=(a=Te[2048-e._choice[0]>>>2])+Te[e._choice[1]>>>2],c=a+Te[2048-e._choice[1]>>>2],l=0,l=0;l<8;++l){if(l>=s)return;i[n+l]=r+ve(e._lowCoder[t],l)}for(;l<16;++l){if(l>=s)return;i[n+l]=o+ve(e._midCoder[t],l-8)}for(;l<s;++l)i[n+l]=c+ve(e._highCoder,l-8-8)}function ae(e,t,s,i){!function(e,t,s,i){s<8?(ye(t,e._choice,0,0),ke(e._lowCoder[i],t,s)):(s-=8,ye(t,e._choice,0,1),s<8?(ye(t,e._choice,1,0),ke(e._midCoder[i],t,s)):(ye(t,e._choice,1,1),ke(e._highCoder,t,s-8)))}(e,t,s,i),0==--e._counters[i]&&(re(e,i,e._tableSize,e._prices,272*i),e._counters[i]=e._tableSize)}function oe(e){return function(e){e._choice=o(2),e._lowCoder=o(16),e._midCoder=o(16),e._highCoder=Pe({},8);for(var t=0;t<16;++t)e._lowCoder[t]=Pe({},3),e._midCoder[t]=Pe({},3)}(e),e._prices=[],e._counters=[],e}function ce(e,t,s){return e._prices[272*s+t]}function le(e,t){for(var s=0;s<t;++s)re(e,s,e._tableSize,e._prices,272*s),e._counters[s]=e._tableSize}function de(e,t,s){return e.m_Coders[((t&e.m_PosMask)<<e.m_NumPrevBits)+((255&s)>>>8-e.m_NumPrevBits)]}function ue(e,t,s){var i,n,r=1;for(n=7;n>=0;--n)i=s>>n&1,ye(t,e.m_Encoders,r,i),r=r<<1|i}function he(e,t,s,i){var n,r,a,o,c=1,l=1;for(r=7;r>=0;--r)n=i>>r&1,o=l,c&&(o+=1+(a=s>>r&1)<<8,c=a==n),ye(t,e.m_Encoders,o,n),l=l<<1|n}function pe(e){return e.m_Encoders=o(768),e}function me(e,t,s,i){var n,r,a=1,o=7,c=0;if(t)for(;o>=0;--o)if(r=s>>o&1,n=i>>o&1,c+=De(e.m_Encoders[(1+r<<8)+a],n),a=a<<1|n,r!=n){--o;break}for(;o>=0;--o)n=i>>o&1,c+=De(e.m_Encoders[a],n),a=a<<1|n;return c}function _e(e){e.BackPrev=-1,e.Prev1IsChar=0}function fe(e,t){return e.NumBitLevels=t,e.Models=o(1<<t),e}function ge(e,t){var s,i=1;for(s=e.NumBitLevels;0!=s;--s)i=(i<<1)+Ce(t,e.Models,i);return i-(1<<e.NumBitLevels)}function Pe(e,t){return e.NumBitLevels=t,e.Models=o(1<<t),e}function ke(e,t,s){var i,n,r=1;for(n=e.NumBitLevels;0!=n;)i=s>>>--n&1,ye(t,e.Models,r,i),r=r<<1|i}function ve(e,t){var s,i,n=1,r=0;for(i=e.NumBitLevels;0!=i;)s=t>>>--i&1,r+=De(e.Models[n],s),n=(n<<1)+s;return r}function be(e,t,s){var i,n,r=1;for(n=0;n<e.NumBitLevels;++n)i=1&s,ye(t,e.Models,r,i),r=r<<1|i,s>>=1}function Ee(e,t){var s,i,n=1,r=0;for(i=e.NumBitLevels;0!=i;--i)s=1&t,t>>>=1,r+=De(e.Models[n],s),n=n<<1|s;return r}function Se(e,t,s,i,n){var r,a,o=1;for(a=0;a<i;++a)ye(s,e,t+o,r=1&n),o=o<<1|r,n>>=1}function Be(e,t,s,i){var n,r,a=1,o=0;for(r=s;0!=r;--r)n=1&i,i>>>=1,o+=Te[(2047&(e[t+a]-n^-n))>>>2],a=a<<1|n;return o}function Ce(e,t,s){var i,n=t[s];return i=(e.Range>>>11)*n,(-2147483648^e.Code)<(-2147483648^i)?(e.Range=i,t[s]=n+(2048-n>>>5)<<16>>16,-16777216&e.Range||(e.Code=e.Code<<8|k(e.Stream),e.Range<<=8),0):(e.Range-=i,e.Code-=i,t[s]=n-(n>>>5)<<16>>16,-16777216&e.Range||(e.Code=e.Code<<8|k(e.Stream),e.Range<<=8),1)}function we(e){for(var t=e.length-1;t>=0;--t)e[t]=1024}var Te=function(){var e,t,s,i=[];for(t=8;t>=0;--t)for(e=1<<9-t,s=1<<9-t-1;s<e;++s)i[s]=(t<<6)+(e-s<<6>>>9-t-1);return i}();function ye(e,t,s,i){var n,r=t[s];n=(e.Range>>>11)*r,i?(e.Low=a(e.Low,c(h(n),[4294967295,0])),e.Range-=n,t[s]=r-(r>>>5)<<16>>16):(e.Range=n,t[s]=r+(2048-r>>>5)<<16>>16),-16777216&e.Range||(e.Range<<=8,Me(e))}function xe(e,t,s){for(var i=s-1;i>=0;--i)e.Range>>>=1,1==(t>>>i&1)&&(e.Low=a(e.Low,h(e.Range))),-16777216&e.Range||(e.Range<<=8,Me(e))}function Le(e){return a(a(h(e._cacheSize),e._position),[4,0])}function Me(e){var t,s,i,n,r=p((i=32,n=f(s=e.Low,i&=63),s[1]<0&&(n=a(n,_([2,0],31))),n));if(0!=r||l(e.Low,[4278190080,0])<0){e._position=a(e._position,h(e._cacheSize)),t=e._cache;do{S(e.Stream,t+r),t=255}while(0!=--e._cacheSize);e._cache=p(e.Low)>>>24}++e._cacheSize,e.Low=_(c(e.Low,[16777215,0]),8)}function De(e,t){return Te[(2047&(e-t^-t))>>>2]}const Ae=[{s:16,f:64,m:0},{s:20,f:64,m:0},{s:19,f:64,m:1},{s:20,f:64,m:1},{s:21,f:128,m:1},{s:22,f:128,m:1},{s:23,f:128,m:1},{s:24,f:255,m:1},{s:25,f:255,m:1}];function Re(e,{mode:t=7,enableEndMark:i=!0}={}){var r={};for(r.c=function(e,t,i,r){return e.output=b({}),function(e,t,i,r,a,c){var d,u;if(l(r,s)<0)throw new Error("invalid length "+r);for(e.length_0=r,d=function(e){var t;for(e._repDistances=o(4),e._optimum=[],e._rangeEncoder={},e._isMatch=o(192),e._isRep=o(12),e._isRepG0=o(12),e._isRepG1=o(12),e._isRepG2=o(12),e._isRep0Long=o(192),e._posSlotEncoder=[],e._posEncoders=o(114),e._posAlignEncoder=Pe({},4),e._lenEncoder=oe({}),e._repMatchLenEncoder=oe({}),e._literalEncoder={},e._matchDistances=[],e._posSlotPrices=[],e._distancesPrices=[],e._alignPrices=o(16),e.reps=o(4),e.repLens=o(4),e.processedInSize=[n],e.processedOutSize=[n],e.finished=[0],e.properties=o(5),e.tempPrices=o(128),e._longestMatchLength=0,e._matchFinderType=1,e._numDistancePairs=0,e._numFastBytesPrev=-1,e.backRes=0,t=0;t<4096;++t)e._optimum[t]={};for(t=0;t<4;++t)e._posSlotEncoder[t]=Pe({},6);return e}({}),function(e,t){!function(e,t){e._dictionarySize=t;for(var s=0;t>1<<s;++s);e._distTableSize=2*s}(t,1<<e.s),t._numFastBytes=e.f,function(e,t){var s=e._matchFinderType;e._matchFinderType=t,e._matchFinder&&s!=e._matchFinderType&&(e._dictionarySizePrev=-1,e._matchFinder=null)}(t,e.m),t._numLiteralPosStateBits=0,t._numLiteralContextBits=3,t._posStateBits=2,t._posStateMask=3}(a,d),d._writeEndMark=c,function(e,t){e.properties[0]=9*(5*e._posStateBits+e._numLiteralPosStateBits)+e._numLiteralContextBits<<24>>24;for(var s=0;s<4;++s)e.properties[1+s]=e._dictionarySize>>8*s<<24>>24;B(t,e.properties,0,5)}(d,i),u=0;u<64;u+=8)S(i,255&p(f(r,u)));e.chunker=(d._needReleaseMFStream=0,d._inStream=t,d._finished=0,function(e){var t,s;e._matchFinder||(t={},s=4,e._matchFinderType||(s=2),function(e,t){e.HASH_ARRAY=t>2,e.HASH_ARRAY?(e.kNumHashDirectBytes=0,e.kMinMatchCheck=4,e.kFixHashSize=66560):(e.kNumHashDirectBytes=2,e.kMinMatchCheck=3,e.kFixHashSize=0)}(t,s),e._matchFinder=t),function(e,t,s){var i,n;if(null==e.m_Coders||e.m_NumPrevBits!=s||e.m_NumPosBits!=t)for(e.m_NumPosBits=t,e.m_PosMask=(1<<t)-1,e.m_NumPrevBits=s,n=1<<e.m_NumPrevBits+e.m_NumPosBits,e.m_Coders=o(n),i=0;i<n;++i)e.m_Coders[i]=pe({})}(e._literalEncoder,e._numLiteralPosStateBits,e._numLiteralContextBits),(e._dictionarySize!=e._dictionarySizePrev||e._numFastBytesPrev!=e._numFastBytes)&&(function(e,t,s,i,n){var r,a;t<1073741567&&(e._cutValue=16+(i>>1),function(e,t,s,i){var n;e._keepSizeBefore=t,e._keepSizeAfter=s,n=t+s+i,(null==e._bufferBase||e._blockSize!=n)&&(e._bufferBase=null,e._blockSize=n,e._bufferBase=o(e._blockSize)),e._pointerToLastSafePosition=e._blockSize-s}(e,t+4096,i+274,256+~~((t+4096+i+274)/2)),e._matchMaxLen=i,r=t+1,e._cyclicBufferSize!=r&&(e._son=o(2*(e._cyclicBufferSize=r))),a=65536,e.HASH_ARRAY&&(a=t-1,a|=a>>1,a|=a>>2,a|=a>>4,a|=a>>8,a>>=1,(a|=65535)>16777216&&(a>>=1),e._hashMask=a,++a,a+=e.kFixHashSize),a!=e._hashSizeSum&&(e._hash=o(e._hashSizeSum=a)))}(e._matchFinder,e._dictionarySize,0,e._numFastBytes),e._dictionarySizePrev=e._dictionarySize,e._numFastBytesPrev=e._numFastBytes)}(d),d._rangeEncoder.Stream=i,function(e){(function(e){e._state=0,e._previousByte=0;for(var t=0;t<4;++t)e._repDistances[t]=0})(e),function(e){e._position=n,e.Low=n,e.Range=-1,e._cacheSize=1,e._cache=0}(e._rangeEncoder),we(e._isMatch),we(e._isRep0Long),we(e._isRep),we(e._isRepG0),we(e._isRepG1),we(e._isRepG2),we(e._posEncoders),function(e){var t,s=1<<e.m_NumPrevBits+e.m_NumPosBits;for(t=0;t<s;++t)we(e.m_Coders[t].m_Encoders)}(e._literalEncoder);for(var t=0;t<4;++t)we(e._posSlotEncoder[t].Models);ne(e._lenEncoder,1<<e._posStateBits),ne(e._repMatchLenEncoder,1<<e._posStateBits),we(e._posAlignEncoder.Models),e._longestMatchWasFound=0,e._optimumEndIndex=0,e._optimumCurrentIndex=0,e._additionalOffset=0}(d),J(d),Z(d),d._lenEncoder._tableSize=d._numFastBytes+1-2,le(d._lenEncoder,1<<d._posStateBits),d._repMatchLenEncoder._tableSize=d._numFastBytes+1-2,le(d._repMatchLenEncoder,1<<d._posStateBits),d.nowPos64=n,function(e,t){return e.encoder=t,e.decoder=null,e.alive=1,e}({},d))}(e,P({},t),e.output,h(t.length),i,r),e}({},function(e){var t,s,i,n=[],r=0,a=e.length;if("object"==typeof e)return e;for(function(e,t,s,i,n){var r;for(r=0;r<s;++r)i[n++]=e.charCodeAt(r)}(e,0,a,n,0),i=0;i<a;++i)(t=n[i])>=1&&t<=127?++r:r+=!t||t>=128&&t<=2047?2:3;for(s=[],r=0,i=0;i<a;++i)(t=n[i])>=1&&t<=127?s[r++]=t<<24>>24:!t||t>=128&&t<=2047?(s[r++]=(192|t>>6&31)<<24>>24,s[r++]=(128|63&t)<<24>>24):(s[r++]=(224|t>>12&15)<<24>>24,s[r++]=(128|t>>6&63)<<24>>24,s[r++]=(128|63&t)<<24>>24);return s}(e),function(e){return Ae[e-1]||Ae[6]}(t),i);H(r.c.chunker););return E(r.c.output)}function Ie(e){var t={};for(t.d=function(e,t){return e.output=b({}),function(e,t,i){var r,a,c,l,d="",u=[];for(a=0;a<5;++a){if(-1==(c=k(t)))throw new Error("truncated input");u[a]=c<<24>>24}if(r=function(e){e.m_OutWindow={},e.m_RangeDecoder={},e.m_IsMatchDecoders=o(192),e.m_IsRepDecoders=o(12),e.m_IsRepG0Decoders=o(12),e.m_IsRepG1Decoders=o(12),e.m_IsRepG2Decoders=o(12),e.m_IsRep0LongDecoders=o(192),e.m_PosSlotDecoder=o(4),e.m_PosDecoders=o(114),e.m_PosAlignDecoder=fe({},4),e.m_LenDecoder=N({}),e.m_RepLenDecoder=N({}),e.m_LiteralDecoder={};for(var t=0;t<4;++t)e.m_PosSlotDecoder[t]=fe({},6);return e}({}),!function(e,t){var s,i,n,r,a,c,l;if(t.length<5)return 0;for(n=(l=255&t[0])%9,r=(c=~~(l/9))%5,a=~~(c/5),s=0,i=0;i<4;++i)s+=(255&t[1+i])<<8*i;return s>99999999||!function(e,t,s,i){if(t>8||s>4||i>4)return 0;!function(e,t,s){var i,n;if(null==e.m_Coders||e.m_NumPrevBits!=s||e.m_NumPosBits!=t)for(e.m_NumPosBits=t,e.m_PosMask=(1<<t)-1,e.m_NumPrevBits=s,n=1<<e.m_NumPrevBits+e.m_NumPosBits,e.m_Coders=o(n),i=0;i<n;++i)e.m_Coders[i]=j({})}(e.m_LiteralDecoder,s,t);var n=1<<i;return W(e.m_LenDecoder,n),W(e.m_RepLenDecoder,n),e.m_PosStateMask=n-1,1}(e,n,r,a)?0:function(e,t){return t<0?0:(e.m_DictionarySize!=t&&(e.m_DictionarySize=t,e.m_DictionarySizeCheck=Math.max(e.m_DictionarySize,1),function(e,t){null!=e._buffer&&e._windowSize==t||(e._buffer=o(t)),e._windowSize=t,e._pos=0,e._streamPos=0}(e.m_OutWindow,Math.max(e.m_DictionarySizeCheck,4096))),1)}(e,s)}(r,u))throw new Error("corrupted input");for(a=0;a<64;a+=8){if(-1==(c=k(t)))throw new Error("truncated input");1==(c=c.toString(16)).length&&(c="0"+c),d=c+""+d}/^0+$|^f+$/i.test(d)?e.length_0=s:(l=parseInt(d,16),e.length_0=l>4294967295?s:h(l)),e.chunker=function(e,t,s,i){return e.m_RangeDecoder.Stream=t,F(e.m_OutWindow),e.m_OutWindow._stream=s,function(e){e.m_OutWindow._streamPos=0,e.m_OutWindow._pos=0,we(e.m_IsMatchDecoders),we(e.m_IsRep0LongDecoders),we(e.m_IsRepDecoders),we(e.m_IsRepG0Decoders),we(e.m_IsRepG1Decoders),we(e.m_IsRepG2Decoders),we(e.m_PosDecoders),function(e){var t,s;for(s=1<<e.m_NumPrevBits+e.m_NumPosBits,t=0;t<s;++t)we(e.m_Coders[t].m_Decoders)}(e.m_LiteralDecoder);for(var t=0;t<4;++t)we(e.m_PosSlotDecoder[t].Models);G(e.m_LenDecoder),G(e.m_RepLenDecoder),we(e.m_PosAlignDecoder.Models),function(e){e.Code=0,e.Range=-1;for(var t=0;t<5;++t)e.Code=e.Code<<8|k(e.Stream)}(e.m_RangeDecoder)}(e),e.state=0,e.rep0=0,e.rep1=0,e.rep2=0,e.rep3=0,e.outSize=i,e.nowPos64=n,e.prevByte=0,function(e,t){return e.decoder=t,e.encoder=null,e.alive=1,e}({},e)}(r,t,i,e.length_0)}(e,P({},t),e.output),e}({},e);H(t.d.chunker););return function(e){for(var t,s,i,n=0,r=0,a=e.length,o=[],c=[];n<a;++n,++r){if(128&(t=255&e[n]))if(192==(224&t)){if(n+1>=a)return e;if(128!=(192&(s=255&e[++n])))return e;c[r]=(31&t)<<6|63&s}else{if(224!=(240&t))return e;if(n+2>=a)return e;if(128!=(192&(s=255&e[++n])))return e;if(128!=(192&(i=255&e[++n])))return e;c[r]=(15&t)<<12|(63&s)<<6|63&i}else{if(!t)return e;c[r]=t}16383==r&&(o.push(String.fromCharCode.apply(String,c)),r=-1)}return r>0&&(c.length=r,o.push(String.fromCharCode.apply(String,c))),o.join("")}(E(t.d.output))}var Fe;!function(e){e.General="General",e.Weapon_Skill="Weapon Skill",e.Ballistic_Skill="Ballistic Skill",e.Strength="Strength",e.Toughness="Toughness",e.Agility="Agility",e.Intelligence="Intelligence",e.Perception="Perception",e.Willpower="Willpower",e.Fellowship="Fellowship",e.Offence="Offence",e.Finesse="Finesse",e.Defence="Defence",e.Psyker="Psyker",e.Tech="Tech",e.Knowledge="Knowledge",e.Leadership="Leadership",e.Fieldcraft="Fieldcraft",e.Social="Social"}(Fe||(Fe={}));class qe{characteristic;amount;constructor(e,t){this.characteristic=e,this.amount=t}toString(){return"<characteristic>"+this.characteristic.name+" "+this.amount+"</characteristic>"}}class ze{skill;choices;amount;constructor(e,t,s){this.skill=e,this.choices=s,this.amount=t}toString(){return this.choices?"<skill>"+this.skill.name+" ("+this.choices.join(", ")+") +"+this.amount+"</skill>":"<skill>"+this.skill.name+" +"+this.amount+"</skill>"}}class He{talent;choices;constructor(e,t){this.talent=e,this.choices=t}toString(){return this.choices?"<talent>"+this.talent.talent+" ("+this.choices.join(", ")+")</talent>":"<talent>"+this.talent.talent+"</talent>"}}class We{class=null;matches=0;constructor(e,t){this.class=e,this.matches=t}}class Oe{role=null;matches=0;constructor(e,t){this.role=e,this.matches=t}}class Ne{world=null;matches=0;constructor(e,t){this.world=e,this.matches=t}}class $e{background=null;matches=0;constructor(e,t){this.background=e,this.matches=t}}class Ge{wishlist;skill_wishlist;characteristic_wishlist;skip0CbChecked;worldSelected;classSelected;backgroundSelected;roleSelected;extraAptitudesSelected;aptitudesWishlist;constructor(){this.wishlist="",this.skill_wishlist="",this.characteristic_wishlist="",this.aptitudesWishlist=[],this.skip0CbChecked=!1,this.worldSelected="",this.classSelected="",this.backgroundSelected="",this.roleSelected="",this.extraAptitudesSelected=[]}}class je{nodeMap=new Map;rootNode=new Ye("");nodeCount=0;treeBuild=!1;get(e){return this.nodeMap.get(e)}getOrCreate(e){let t=this.nodeMap.get(e);return t||(this.nodeCount++,t=new Ye(e),this.nodeMap.set(e,t)),t}linkParentToChild(e,t){e.children.push(t),t.parents.push(e)}buildTree(e){if(this.treeBuild)return this;if(e)for(const e of this.nodeMap.values())0===e.parents.length&&this.linkParentToChild(this.rootNode,e);for(const e of this.nodeMap.values())e.children.sort(((e,t)=>e.name.localeCompare(t.name)));return e&&this.rootNode.children.sort(((e,t)=>e.name.localeCompare(t.name))),this.treeBuild=!0,this}iterateParents(e){const t=[];for(const s of e.parents)t.push(...this.iterateParents(s)),t.push(s);return t}}class Ye{name;parents;children;data;constructor(e){this.name=e,this.data=null,this.parents=[],this.children=[]}}class Ue{text="";skillPick=null;characteristicPick=null;talentPick=null;and=[];or=[];constructor(e){this.text=e}}(new class{tree=new je;fullTree=new je;data;configData=new Ge;selectedAptitudes=[];source="ow";start(){const e=window.location.search,t=new URLSearchParams(e),s=t.get("source"),i=t.get("cfg"),n=s||"ow";fetch("assets/w40k-"+n+".json").then((e=>e.json())).then((e=>this.$start(e,n,i)))}scrollToAnchor(e){const t=document.getElementById(e),s=t.getBoundingClientRect().top+window.scrollY-100;window.scrollTo({top:s,behavior:"auto"});const i=["animate__animated","animate__faster","animate__flash"];t.classList.add(...i),t.addEventListener("animationend",(()=>t.classList.remove(...i)))}randomStr(e){let t="";let s=0;for(;s<e;)t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random())),s+=1;return t}$start(e,t,s){this.data=e,this.data.talents.forEach((e=>{e.expandsTo=[]})),this.source=t,this.buildFullTree(),this.buildPrerequisitesTree(),this.loadConfigData(t,s),this.createClassSelectContainer(),this.createWorldSelectContainer(),this.createBackgroundSelectContainer(),this.createRoleSelectContainer(),this.createAptitudeSelect(),this.createAptitudeWishlistSelect(),this.createSkipZeroMatchesCheckbox();{const e=this.createCharacteristicWishlist();this.createExportCharacteristic(),this.createExportCharacteristicWishlist(),this.createCharacteristicWishlistClear(e)}{const e=this.createSkillWishlist();this.createExportSkill(),this.createExportSkillWishlist(),this.createSkillWishlistClear(e)}{const e=this.createTalentWishlist();this.createExportTalent(),this.createExportTalentWishlist(),this.createTalentWishlistClear(e)}this.createExportAll(),this.createSelectPicker(),this.rebuildTables(null),this.styleAptitudeMatches(null,e)}buildPrerequisitesTree(){this.data.talents.forEach((e=>{if(e.prerequisiteTree=this.resolvePrerequisiteText(e,new Ue(e.prerequisites)),"-"!==e.prerequisites&&"—"!==e.prerequisites){const t=this.splitPrerequisites(e.prerequisites);if(t.length>1)for(let s=0;s<t.length;s++){const i=t[s],n=this.resolvePrerequisiteText(e,new Ue(i));e.prerequisiteTree.and.push(n);const r=i.split(/ or (?!more\b)(?![^()]*\))/gi).map((e=>e.trim()));if(r.length>1)for(let t=0;t<r.length;t++){const s=r[t],i=this.resolvePrerequisiteText(e,new Ue(s));n.or.push(i)}}}}))}createSelectPicker(){$("._selectpicker").selectpicker()}loadConfigData(e,t){const s=localStorage.getItem("w40k-data-config-"+e);if(t)if(t.startsWith("%7B")||t.startsWith("{"))console.log("load-json","w40k-data-config-"+this.source,t),this.configData=JSON.parse(t);else{const e=Ie(new Int8Array(function(e,t){for(var s,i,n,r=e.replace(/[^A-Za-z0-9\+\/]/g,""),a=r.length,o=3*a+1>>>2,c=new Uint8Array(o),l=0,d=0,u=0;u<a;u++)if(i=3&u,l|=((n=r.charCodeAt(u))>64&&n<91?n-65:n>96&&n<123?n-71:n>47&&n<58?n+4:43===n?62:47===n?63:0)<<18-6*i,3===i||a-u==1){for(s=0;s<3&&d<o;s++,d++)c[d]=l>>>(16>>>s&24)&255;l=0}return c}(decodeURIComponent(t).replace(/-/g,"+").replace(/_/g,"/"))));console.log("load-compressed","w40k-data-config-"+this.source,e),this.configData=JSON.parse(e)}else s&&(console.log("load-browser","w40k-data-config-"+this.source,s),this.configData=JSON.parse(s))}createCharacteristicWishlistClear(e){document.getElementById("characteristic_wishlist_clear").addEventListener("click",(t=>{e.value="",this.rebuildTables(t)}))}createSkillWishlistClear(e){document.getElementById("skill_wishlist_clear").addEventListener("click",(t=>{e.value="",this.rebuildTables(t)}))}createTalentWishlistClear(e){document.getElementById("wishlist_clear").addEventListener("click",(t=>{e.value="",this.rebuildTables(t)}))}createExportAll(){document.getElementById("export_all").addEventListener("click",(e=>this.exportAllTableToExcelDef("characteristic","skill","talent")))}createExportTalentWishlist(){document.getElementById("export_talent_wishlist").addEventListener("click",(e=>this.copyWishlistToClipboard("talent",3)))}createExportSkillWishlist(){document.getElementById("export_skill_wishlist").addEventListener("click",(e=>this.copyWishlistToClipboard("skill",2)))}createExportCharacteristicWishlist(){document.getElementById("export_characteristic_wishlist").addEventListener("click",(e=>this.copyWishlistToClipboard("characteristic",2)))}createExportTalent(){document.getElementById("export_talent").addEventListener("click",(e=>this.copyTableDivToClipboard("talent")))}createExportSkill(){document.getElementById("export_skill").addEventListener("click",(e=>this.copyTableDivToClipboard("skill")))}createExportCharacteristic(){document.getElementById("export_characteristic").addEventListener("click",(e=>this.copyTableDivToClipboard("characteristic")))}createTalentWishlist(){const e=document.getElementById("wishlist");return e.value=this.configData.wishlist,e.addEventListener("change",(e=>this.rebuildTables(e))),e}createSkillWishlist(){const e=document.getElementById("skill_wishlist");return e.value=this.configData.skill_wishlist,e.addEventListener("change",(e=>this.rebuildTables(e))),e}createCharacteristicWishlist(){const e=document.getElementById("characteristic_wishlist");return e.value=this.configData.characteristic_wishlist,e.addEventListener("change",(e=>this.rebuildTables(e))),e}createSkipZeroMatchesCheckbox(){const e=document.getElementById("skip0Cb");e.checked=this.configData.skip0CbChecked,e.addEventListener("change",(e=>this.rebuildTables(e)))}createAptitudeWishlistSelect(){const e=document.getElementById("aptitudeWishlistSelect");for(let t=0;t<this.data.optional.length;t++){const s=document.createElement("option");s.text=this.data.optional[t],s.value=this.data.optional[t],this.configData.aptitudesWishlist&&this.configData.aptitudesWishlist.includes(this.data.optional[t])&&(s.selected=!0),e.add(s)}e.addEventListener("change",(e=>{this.logMatchingClasses(e,this.data),this.logMatchingWorlds(e,this.data),this.logMatchingBackgrounds(e,this.data),this.logMatchingRoles(e,this.data),this.styleAptitudeMatches(e,this.data)}))}createAptitudeSelect(){const e=document.getElementById("aptitudeSelect");for(let t=0;t<this.data.optional.length;t++){const s=document.createElement("option");s.text=this.data.optional[t],s.value=this.data.optional[t],this.configData.extraAptitudesSelected&&this.configData.extraAptitudesSelected.includes(this.data.optional[t])&&(s.selected=!0),e.add(s)}e.addEventListener("change",(e=>this.rebuildTables(e)))}createRoleSelectContainer(){const e=document.getElementById("roleSelectContainer");if(this.data.roles&&this.data.roles.length>0){const e=document.getElementById("roleSelect");{const t=document.createElement("option");t.text="None",e.add(t)}for(let t=0;t<this.data.roles.length;t++){const s=document.createElement("option"),i=this.data.roles[t].aptitudes,{aptitudesToText:n,aptitudesToHtml:r}=this.aptitudesToTextAndHtml(i);s.text=this.data.roles[t].role+" ("+n.trim()+")",s.setAttribute("data-content",this.data.roles[t].role+" "+r),s.value=this.data.roles[t].role,this.configData.roleSelected&&this.configData.roleSelected==this.data.roles[t].role&&(s.selected=!0),e.add(s)}e.addEventListener("change",(e=>this.rebuildTables(e)))}else e.style.display="none"}createBackgroundSelectContainer(){const e=document.getElementById("backgroundSelectContainer");if(this.data.backgrounds&&this.data.backgrounds.length>0){const e=document.getElementById("backgroundSelect");{const t=document.createElement("option");t.text="None",e.add(t)}for(let t=0;t<this.data.backgrounds.length;t++){const s=document.createElement("option");s.text=this.data.backgrounds[t].background+" ("+this.data.backgrounds[t].aptitude+")",s.setAttribute("data-content",this.data.backgrounds[t].background+" <span class='badge badge-pill badge-secondary "+this.data.backgrounds[t].aptitude.replace(" ","_")+"'>"+this.data.backgrounds[t].aptitude+"</span>"),s.value=this.data.backgrounds[t].background,this.configData.backgroundSelected&&this.configData.backgroundSelected==this.data.backgrounds[t].background&&(s.selected=!0),e.add(s)}e.addEventListener("change",(e=>this.rebuildTables(e)))}else e.style.display="none"}createWorldSelectContainer(){const e=document.getElementById("worldSelectContainer");if(this.data.worlds&&this.data.worlds.length>0){const e=document.getElementById("worldSelect");{const t=document.createElement("option");t.text="None",e.add(t)}for(let t=0;t<this.data.worlds.length;t++){const s=document.createElement("option");s.text=this.data.worlds[t].world+" ("+this.data.worlds[t].aptitude+")",s.setAttribute("data-content",this.data.worlds[t].world+" <span class='badge badge-pill badge-secondary "+this.data.worlds[t].aptitude.replace(" ","_")+"'>"+this.data.worlds[t].aptitude+"</span>"),s.value=this.data.worlds[t].world,this.configData.worldSelected&&this.configData.worldSelected==this.data.worlds[t].world&&(s.selected=!0),e.add(s)}e.addEventListener("change",(e=>this.rebuildTables(e)))}else e.style.display="none"}createClassSelectContainer(){const e=document.getElementById("classSelectContainer");if(this.data.classes&&this.data.classes.length>0){const e=document.getElementById("classSelect");{const t=document.createElement("option");t.text="None",e.add(t)}for(let t=0;t<this.data.classes.length;t++){const s=document.createElement("option"),i=this.data.classes[t].aptitudes,{aptitudesToText:n,aptitudesToHtml:r}=this.aptitudesToTextAndHtml(i);s.text=this.data.classes[t].class+" ("+n.trim()+")",s.setAttribute("data-content",this.data.classes[t].class+" "+r),s.value=this.data.classes[t].class,this.configData.classSelected&&this.configData.classSelected==this.data.classes[t].class&&(s.selected=!0),e.add(s)}e.addEventListener("change",(e=>this.rebuildTables(e)))}else e.style.display="none"}resolvePrerequisiteText(e,t){return"-"===t.text||"—"===t.text?(t.text="",t):(this.data.talents.forEach((s=>{const i=new RegExp("^"+s.talent+" \\((.+)\\)$","i");if(i.test(t.text)){const n=t.text.match(i)[1];t.talentPick=new He(s,n.split(",").map((e=>e.trim()))),e.expandsTo.push(s)}else s.talent.toLowerCase()==t.text.toLowerCase()&&(t.talentPick=new He(s),e.expandsTo.push(s))})),this.data.characteristic.forEach((e=>{const s=new RegExp("^"+e.name+" (\\d+)$","i");if(s.test(t.text)){const i=parseInt(t.text.match(s)[1]);t.characteristicPick=new qe(e,i)}})),this.data.skills.forEach((e=>{const s=new RegExp("^"+e.name+" \\((.+)\\) \\+(\\d+)$","i"),i=new RegExp("^"+e.name+" \\+(\\d+)$","i");if(s.test(t.text)){const i=parseInt(t.text.match(s)[2]),n=t.text.match(s)[1];t.skillPick=new ze(e,i,n.split(",").map((e=>e.trim())))}else if(i.test(t.text)){const s=parseInt(t.text.match(i)[1]);t.skillPick=new ze(e,s)}})),t)}buildFullTree(){this.data.talents.forEach((e=>{const t=e.talent.toLowerCase().trim();this.data.talents.forEach((s=>{if(s.prerequisites.toLowerCase().includes(t)){const t=this.fullTree.getOrCreate(e.talent);t.data=e;const i=this.fullTree.getOrCreate(s.talent);i.data=s,this.fullTree.linkParentToChild(t,i)}}))})),this.fullTree.buildTree(!1)}aptitudesToTextAndHtml(e){let t="",s="";for(let i=0;i<e.length;i++)t+=e[i],s+="<span class='badge badge-pill badge-secondary "+e[i].replace(" ","_")+"'>"+e[i]+"</span>",i<e.length-1&&(t+=", ");return{aptitudesToText:t,aptitudesToHtml:s}}rebuildTables(e){this.tree=new je;const t=this.rebuildTalentWishlist(),s=this.rebuildSkillWishlist(),i=this.rebuildCharacteristicWishlist();this.selectedAptitudes=[],this.selectedAptitudes.push(this.data.free);const n=this.rebuildDuplicateAptitudes();this.rebuildBackgroundSelect(n),this.rebuildAptitudeSelect(n);const r=this.rebuildSkipZeroMatches();this.rebuildTablesCharacteristics(i,r),this.rebuildTablesTalents(t,r),this.rebuildTablesSkills(s,r),this.buildSelectedTree(),$("[title]:not(.dropdown-toggle)").tooltip(),this.save()}rebuildTablesSkills(e,t){const s=document.getElementById("skill");s.innerHTML="";const i=this.data.skills.sort(((e,t)=>{let s=0;this.selectedAptitudes.includes(e.aptitudes[0])&&s++,this.selectedAptitudes.includes(e.aptitudes[1])&&s++;let i=0;return this.selectedAptitudes.includes(t.aptitudes[0])&&i++,this.selectedAptitudes.includes(t.aptitudes[1])&&i++,i-s}));for(let n=0;n<i.length;n++){if(0!=e.length&&!e.includes(i[n].name.toLowerCase().trim()))continue;const r=document.createElement("div"),a=document.createElement("div");let o=!1;for(let e=0;e<this.data.costs.length;e++)if("skill"===this.data.costs[e].type){let s=0;this.selectedAptitudes.includes(i[n].aptitudes[0])&&s++,this.selectedAptitudes.includes(i[n].aptitudes[1])&&s++,o=this.calcSkipAndSetMatchCount(r,e,s,a,t,o)}if(o)continue;const c=document.createElement("div");s.appendChild(c),c.appendChild(r),c.appendChild(a);const l=document.createElement("div");l.innerHTML=i[n].name,c.appendChild(l);for(let e=0;e<i[n].aptitudes.length;e++){const t=document.createElement("div");t.innerHTML=i[n].aptitudes[e],this.selectedAptitudes.includes(i[n].aptitudes[e])&&t.classList.add("m2"),c.appendChild(t)}}}rebuildTablesTalents(e,t){const s=document.getElementById("talent");s.innerHTML="";const i=this.data.talents.sort(((e,t)=>{let s=0;this.selectedAptitudes.includes(e.apt1)&&s++,this.selectedAptitudes.includes(e.apt2)&&s++;let i=0;return this.selectedAptitudes.includes(t.apt1)&&i++,this.selectedAptitudes.includes(t.apt2)&&i++,s===i?e.tier-t.tier:i-s}));for(let n=0;n<i.length;n++){if(0!=e.length&&!e.includes(i[n].talent.toLowerCase().trim()))continue;const r=document.createElement("div");r.setAttribute("data-export","true");const a=document.createElement("div");a.setAttribute("data-export","true");let o=!1;for(let e=0;e<this.data.costs.length;e++)if("talent"===this.data.costs[e].type){let s=0;this.selectedAptitudes.includes(i[n].apt1)&&s++,this.selectedAptitudes.includes(i[n].apt2)&&s++,r.innerHTML=""+this.data.costs[e].cost[2-s][i[n].tier-1],r.classList.add("m"+s),a.innerHTML=""+s,a.classList.add("m"+s),0===s&&t&&(o=!0)}if(o)continue;const c=document.createElement("div");s.appendChild(c),c.appendChild(r),c.appendChild(a);const l=document.createElement("div");l.setAttribute("data-export","true"),l.innerHTML="T"+i[n].tier,c.appendChild(l);const d=document.createElement("div");d.setAttribute("data-export","true"),d.innerHTML=i[n].talent,c.appendChild(d),d.title=i[n].benefit,d.id=i[n].talent,i[n].ref&&(d.title+=" ( "+i[n].ref.replace("PG","").trim()+" )");const u=document.createElement("div");u.setAttribute("data-export","true"),u.innerHTML=i[n].apt1,c.appendChild(u),this.selectedAptitudes.includes(i[n].apt1)&&u.classList.add("m2");const h=document.createElement("div");h.setAttribute("data-export","true"),h.innerHTML=i[n].apt2,c.appendChild(h),this.selectedAptitudes.includes(i[n].apt2)&&h.classList.add("m2");const p=document.createElement("div");p.setAttribute("data-export",i[n].prerequisites),this.replacePrerequisites(i[n],p,i[n].prerequisites),c.appendChild(p);const m=document.createElement("div");m.setAttribute("data-export","true"),m.innerHTML=i[n].benefit,m.style.display="none",c.appendChild(m);const _=document.createElement("div");if(_.setAttribute("data-export","false"),c.appendChild(_),"-"!=i[n].prerequisites&&"—"!==i[n].prerequisites){const e=this.randomStr(10);this.logPrerequisiteTree("",i[n].prerequisiteTree),this.prerequisitesAsTree(i[n]),this.prerequisitesAsList(i[n]);const t=this.newPrerequisitesAsTree(i[n].prerequisiteTree,document.createElement("div")).innerHTML,s=this.newPrerequisitesAsList(i[n].prerequisiteTree,document.createElement("div")).innerHTML;let r;r=t==s?`\n\t\t\t\t\t\t<h5>${i[n].talent}</h5>\n\t\t\t\t\t\t<span class='tiny-ul'>\n\t\t\t\t\t\t\t<h6>Prerequisites</h6>\n\t\t\t\t\t\t\t${t}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t`:`\n\t\t\t\t\t\t<h5>${i[n].talent}</h5>\n\t\t\t\t\t\t<span class='tiny-ul'>\n\t\t\t\t\t\t\t<h6>Prerequisite Tree</h6>\n\t\t\t\t\t\t\t${t}\n\t\t\t\t\t\t\t<hr>\n\t\t\t\t\t\t\t<h6>Prerequisite List</h6>\n\t\t\t\t\t\t\t${s}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t`,_.innerHTML=`<button id="${e}" type="button" class="unstyled-button" data-container="body" data-toggle="popover" data-placement="left" data-content="${r}"><i class='icon-as-button fa-regular fa-eye'></i></button>`,$("#"+e).popover({trigger:"focus",html:!0})}}}rebuildSkipZeroMatches(){const e=document.getElementById("skip0Cb");return this.configData.skip0CbChecked=e.checked,e.checked}rebuildTablesCharacteristics(e,t){const s=document.getElementById("characteristic");s.innerHTML="";const i=this.data.characteristic.sort(((e,t)=>{let s=0;this.selectedAptitudes.includes(e.name)&&s++,this.selectedAptitudes.includes(e.aptitude)&&s++;let i=0;return this.selectedAptitudes.includes(t.name)&&i++,this.selectedAptitudes.includes(t.aptitude)&&i++,i-s}));for(let n=0;n<i.length;n++){if(0!=e.length&&!e.includes(i[n].name.toLowerCase().trim()))continue;const r=document.createElement("div"),a=document.createElement("div");let o=!1;for(let e=0;e<this.data.costs.length;e++)if("characteristic"===this.data.costs[e].type){let s=0;this.selectedAptitudes.includes(i[n].name)&&s++,this.selectedAptitudes.includes(i[n].aptitude)&&s++,o=this.calcSkipAndSetMatchCount(r,e,s,a,t,o)}if(o)continue;const c=document.createElement("div");s.appendChild(c),c.appendChild(r),c.appendChild(a);const l=document.createElement("div");l.innerHTML=i[n].name,this.selectedAptitudes.includes(i[n].name)&&l.classList.add("m2"),c.appendChild(l);const d=document.createElement("div");d.innerHTML=i[n].aptitude,this.selectedAptitudes.includes(i[n].aptitude)&&d.classList.add("m2"),c.appendChild(d)}}rebuildAptitudeSelect(e){const t=document.getElementById("aptitudeSelect");if(this.configData.extraAptitudesSelected=[],t.selectedIndex>=0){const s=t.selectedOptions;for(let t=0;t<s.length;t++){const i=this.data.optional[s[t].index];this.configData.extraAptitudesSelected.push(i),this.selectedAptitudes.includes(i)?e.push(i):this.selectedAptitudes.push(i)}}const s=document.getElementById("selectedAptitudes");s.innerHTML="";for(let e=0;e<this.selectedAptitudes.length;e++)s.innerHTML+="<span class='badge badge-pill badge-secondary "+this.selectedAptitudes[e].replace(" ","_")+"'>"+this.selectedAptitudes[e]+"</span>&nbsp;";for(let t=0;t<e.length;t++)s.innerHTML+="<span class='badge badge-pill badge-danger'>"+e[t]+" (duplicate)</span>"}rebuildBackgroundSelect(e){const t=document.getElementById("backgroundSelect");if(t.selectedIndex>0){const s=this.data.backgrounds[t.selectedIndex-1],i=s.aptitude;this.configData.backgroundSelected=s.background,this.selectedAptitudes.includes(i)?e.push(i):this.selectedAptitudes.push(i)}else this.configData.backgroundSelected=""}rebuildDuplicateAptitudes(){const e=[],t=document.getElementById("classSelect");if(t.selectedIndex>0){const s=this.data.classes[t.selectedIndex-1],i=s.aptitudes;this.configData.classSelected=s.class;for(let t=0;t<i.length;t++)this.selectedAptitudes.includes(i[t])?e.push(i[t]):this.selectedAptitudes.push(i[t])}else this.configData.classSelected="";const s=document.getElementById("worldSelect");if(s.selectedIndex>0){const t=this.data.worlds[s.selectedIndex-1],i=t.aptitude;this.configData.worldSelected=t.world,this.selectedAptitudes.includes(i)?e.push(i):this.selectedAptitudes.push(i)}else this.configData.worldSelected="";const i=document.getElementById("roleSelect");if(i.selectedIndex>0){const t=this.data.roles[i.selectedIndex-1],s=t.aptitudes;this.configData.roleSelected=t.role;for(let t=0;t<s.length;t++)this.selectedAptitudes.includes(s[t])?e.push(s[t]):this.selectedAptitudes.push(s[t])}else this.configData.roleSelected="";return e}rebuildCharacteristicWishlist(){const e=document.getElementById("characteristic_wishlist");this.configData.characteristic_wishlist=e.value;const t=e.value.split("\n");for(let e=0;e<t.length;e++)""===t[e]&&(t.splice(e,1),e--);for(let e=0;e<t.length;e++)t[e]=t[e].toLowerCase().trim();return t}rebuildSkillWishlist(){const e=document.getElementById("skill_wishlist");this.configData.skill_wishlist=e.value;const t=e.value.split("\n");for(let e=0;e<t.length;e++)""===t[e]&&(t.splice(e,1),e--);for(let e=0;e<t.length;e++)t[e]=t[e].toLowerCase().trim();return t}rebuildTalentWishlist(){const e=document.getElementById("wishlist");this.configData.wishlist=e.value;const t=e.value.split("\n");for(let e=0;e<t.length;e++)""===t[e]&&(t.splice(e,1),e--);for(let e=0;e<t.length;e++)t[e]=t[e].toLowerCase().trim();return t}prerequisitesAsTree(e){const t=this.fullTree.get(e.talent);return null==t||0==t.parents.length?null:this.prerequisitesAsTreeNested(e.prerequisites)}prerequisitesAsTreeNested(e){const t=this.splitPrerequisites(e);let s="<ul>";for(let e=0;e<t.length;e++)"-"!=t[e]&&"—"!=t[e]&&(s+="<li>",s+=t[e],this.data.talents.forEach((i=>{t[e].toLowerCase().includes(i.talent.toLowerCase())&&(s+=this.prerequisitesAsTreeNested(i.prerequisites))})),s+="</li>");return s+="</ul>",s}prerequisitesAsList(e){const t=this.fullTree.get(e.talent);if(null==t||0==t.parents.length)return null;const s=[];if(t&&t.parents.length>0){this.fullTree.iterateParents(t).forEach((e=>{if(e.data&&e.data.prerequisites&&"—"!=e.data.prerequisites&&"-"!=e.data.prerequisites){const t=this.splitPrerequisites(e.data.prerequisites);for(let e=0;e<t.length;e++)s.push(t[e])}}));{const t=this.splitPrerequisites(e.prerequisites);for(let e=0;e<t.length;e++)s.push(t[e])}}if(0==s.length)return null;const i=[],n=[],r=[];s.forEach((e=>{let t=!1;if(this.data.characteristic.forEach((s=>{const n=new RegExp("^"+s.name+" (\\d+)$","i");if(n.test(e)){const r=parseInt(e.match(n)[1]),a=i.filter((e=>e.characteristic.name===s.name));if(a.length>0){const e=a[0];e.amount<r&&(e.amount=r)}else i.push({characteristic:s,amount:r});t=!0}})),this.data.skills.forEach((s=>{const i=new RegExp("^"+s.name+" \\((.+)\\) \\+(\\d+)$","i"),r=new RegExp("^"+s.name+" \\+(\\d+)$","i");let a,o;if(i.test(e)?(a=parseInt(e.match(i)[2]),o=e.match(i)[1].split(",").map((e=>e.trim())),t=!0):r.test(e)&&(a=parseInt(e.match(r)[1]),t=!0),null!=a){const e=n.filter((e=>e.skill.name===s.name&&e.choices===o));if(e.length>0){const t=e[0];t.amount<a&&(t.amount=a)}else n.push(new ze(s,a,o))}})),!t){const t=`${e}`;-1===r.indexOf(t)&&r.push(t)}})),r.sort(((e,t)=>e.localeCompare(t))),i.sort(((e,t)=>e.characteristic.name.localeCompare(t.characteristic.name))).forEach((e=>{r.push(`<i>Characteristic</i>: ${e.characteristic.name} ${e.amount}`)})),n.sort(((e,t)=>e.skill.name.localeCompare(t.skill.name))).forEach((e=>{e.choices&&e.choices.length>0?r.push(`<i>Skill</i>: ${e.skill.name} (${e.choices}) +${e.amount}`):r.push(`<i>Skill</i>: ${e.skill.name} +${e.amount}`)}));let a="<ul>";for(let e=0;e<r.length;e++)a+="<li>"+r[e]+"</li>";return a+="</ul>",a}buildSelectedTree(){const e=this.tree;e.buildTree(!0);const t={name:e.rootNode.name,parent:null,children:[]};!function e(t,s){t.children.forEach((i=>{const n={name:i.name,parent:t.name,children:[],data:i.data};s.children.push(n),e(i,n)}))}(e.rootNode,t),drawChart("selectedTree",t,e.nodeCount)}splitPrerequisites(e){return e.split(/,(?![^()]*\))/).map((e=>e.trim()))}replacePrerequisites(e,t,s){if("—"==s||"-"==s){const e=document.createElement("span");return e.innerHTML="—",t.appendChild(e),!1}const i=document.createElement("ul");let n=!1;const r=this.splitPrerequisites(s);for(let t=0;t<r.length;t++){const s=r[t].trim(),a=document.createElement("li"),o=s.toLowerCase(),c=[],l=[];if(this.data.talents.forEach((t=>{const s=o.indexOf(t.talent.toLowerCase());if(s>=0&&!l.includes(t.talent)){l.push(t.talent),c.push({from:s,to:t.talent.length,talent:t});const i=this.tree.getOrCreate(t.talent);i.data=t;const n=this.tree.getOrCreate(e.talent);n.data=e,this.tree.linkParentToChild(i,n)}})),c.length>0){c.sort(((e,t)=>e.from-t.from));let e=0;for(;e<s.length;)if(c.length>0&&c[0].from==e){const t=document.createElement("span");t.classList.add("jump-to-anchor"),t.setAttribute("title",c[0].talent.benefit);const s=c[0].talent.talent;t.innerText=s,t.setAttribute("data-talent",s),t.onclick=()=>this.scrollToAnchor(s),a.appendChild(t),e+=c[0].to,c.shift(),n=!0}else if(c.length>0){const t=document.createElement("span");t.innerText=s.substring(e,c[0].from),a.appendChild(t),e=c[0].from}else{const t=document.createElement("span");t.innerText=s.substring(e),a.appendChild(t),e=s.length}}else a.innerText=s;i.appendChild(a)}return t.appendChild(i),n}save(){const t=JSON.stringify(this.configData);console.log("save","w40k-data-config-"+this.source,t),localStorage.setItem("w40k-data-config-"+this.source,t);const s=function(t,{mode:s=7,enableEndMark:i=!0}={}){const n=Re(t,{mode:s,enableEndMark:i});return r=new Uint8Array(n),encodeURIComponent(function(t){for(var s,i=(3-t.length%3)%3,n="",r=t.length,a=0,o=0;o<r;o++)s=o%3,a|=t[o]<<(16>>>s&24),2!==s&&t.length-o!=1||(n+=String.fromCharCode(e(a>>>18&63),e(a>>>12&63),e(a>>>6&63),e(63&a)),a=0);return 0===i?n:n.substring(0,n.length-i)+(1===i?"=":"==")}(r).replace(/\+/g,"-").replace(/\//g,"_"));var r}(t),i=encodeURIComponent(t);document.getElementById("saveLink").href="?source="+this.source+"&cfg="+i,document.getElementById("saveLinkAlt").href="?source="+this.source+"&cfg="+s}calcSkipAndSetMatchCount(e,t,s,i,n,r){return e.innerHTML=""+this.data.costs[t].cost[2-s][0],e.classList.add("m"+s),i.innerHTML=""+s,i.classList.add("m"+s),0===s&&n&&(r=!0),r}exportAllTableToExcelDef(e,t,s){document.getElementById("exportTableToExcelDef")?.remove();const i=this.exportDivToTable(e),n=this.exportDivToTable(t),r=this.exportDivToTable(s);if(!i)return;if(!n)return;if(!r)return;const a=document.createElement("div"),o=i.replace("<table>","").replace("</table>",""),c=n.replace("<table>","").replace("</table>",""),l=r.replace("<table>","").replace("</table>","");a.innerHTML=`<table>\n\t\t\t<tr><td>Characteristics</td></tr>\n\t\t\t<tr>\n\t\t\t\t<td>cost</td>\n\t\t\t\t<td>m</td>\n\t\t\t\t<td>skill</td>\n\t\t\t\t<td>aptitude</td>\n\t\t\t</tr>\n\t\t\t${o}\n\t\t\t<tr><td> </td></tr>\n\t\t\t<tr><td> </td></tr>\n\t\t\t<tr><td>Skills</td></tr>\n\t\t\t<tr>\n\t\t\t\t<td>cost</td>\n\t\t\t\t<td>m</td>\n\t\t\t\t<td>characteristic</td>\n\t\t\t\t<td>aptitude</td>\n\t\t\t\t<td>aptitude</td>\n\t\t\t</tr>\n\t\t\t${c}\n\t\t\t<tr><td> </td></tr>\n\t\t\t<tr><td> </td></tr>\n\t\t\t<tr><td>Talents</td></tr>\n\t\t\t<tr>\n\t\t\t\t<td>cost</td>\n\t\t\t\t<td>m</td>\n\t\t\t\t<td>tier</td>\n\t\t\t\t<td>talent</td>\n\t\t\t\t<td>aptitude</td>\n\t\t\t\t<td>aptitude</td>\n\t\t\t\t<td>requirement</td>\n\t\t\t\t<td>description</td>\n\t\t\t</tr>\n\t\t\t${l}\n\t\t\t</table>`,a.style.display="none",a.id="exportTableToExcelDef",document.body.appendChild(a),this.exportTableToExcel("exportTableToExcelDef","all")}exportTableToExcelDef(e){const t="exportTableToExcelDef_";document.getElementById(t)?.remove();const s=this.exportDivToTable(e);if(!s)return;const i=document.createElement("div");i.innerHTML=s,i.style.display="none",i.id=t,document.body.appendChild(i),this.exportTableToExcel(i.id,e)}exportDivToTable(e,t=!1){const s=document.getElementById(e);if(!s)return;let i="";t||(i+="<table>");for(let e=0;e<s.children.length;e++){t||(i+="<tr>");const n=s.children[e];for(let e=0;e<n.children.length;e++){const s=n.children[e],r=s.getAttribute("data-export");"false"!==r&&(t||(i+="<td>"),i+="true"===r||null===r?s.innerHTML:r,i+=t?"\t":"</td>")}i+=t?"\n":"</tr>"}return t||(i+="</table>"),i}exportTableToExcel(e,t=""){const s="application/vnd.ms-excel",i=document.getElementById(e);if(!i)return;const n=i.outerHTML.replace(/ /g,"%20");t=t?t+".html.xls":"w40k.html.xls",document.getElementById("downloadLinkId")?.remove();const r=document.createElement("a");if(r.id="downloadLinkId",document.body.appendChild(r),navigator.msSaveOrOpenBlob){const e=new Blob(["\ufeff",n],{type:s});navigator.msSaveOrOpenBlob(e,t)}else r.href="data:"+s+", "+n,r.download=t,r.click()}copyTableDivToClipboard(e){const t=this.exportDivToTable(e,!0);if(!t)return;const s="1_textarea_copy_";document.getElementById(s+e)?.remove();const i=document.createElement("textarea");i.innerHTML=t,i.style.display="none",i.id=s+e,document.body.appendChild(i),i.select(),i.setSelectionRange(0,99999),navigator.clipboard.writeText(i.value)}copyWishlistToClipboard(e,t){const s=document.getElementById(e);if(!s)return;let i="";for(let e=0;e<s.children.length;e++){const n=s.children[e],r=n.children[1];"0"!=r.innerHTML&&"1"!=r.innerHTML||(i+=n.children[t].innerHTML+"\n")}const n="2_textarea_copy_"+e;document.getElementById(n)?.remove();const r=document.createElement("textarea");r.innerHTML=i,r.style.display="none",r.id=n,document.body.appendChild(r),r.select(),r.setSelectionRange(0,99999),navigator.clipboard.writeText(r.value).then((()=>{}))}logMatchingWorlds(e,t){if(!t.worlds||0==t.worlds.length)return;const s=document.getElementById("aptitudeWishlistSelect");if(s.selectedIndex>=0){console.log("logMatchingWorlds");const e=s.selectedOptions,i=[],n=[];for(let t=0;t<e.length;t++)i.push(this.data.optional[e[t].index]);console.log(i);for(let e=0;e<t.worlds.length;e++){let s=0;for(let n=0;n<i.length;n++)t.worlds[e].aptitude==i[n]&&s++;n.push(new Ne(t.worlds[e],s))}n.sort(((e,t)=>t.matches-e.matches));for(let e=0;e<n.length;e++)console.log(n[e].world?.world,n[e].matches,n[e].world?.aptitude)}}logMatchingBackgrounds(e,t){if(!t.backgrounds||0==t.backgrounds.length)return;const s=document.getElementById("aptitudeWishlistSelect");if(s.selectedIndex>=0){console.log("logMatchingBackgrounds");const e=s.selectedOptions,i=[],n=[];for(let t=0;t<e.length;t++)i.push(this.data.optional[e[t].index]);console.log(i);for(let e=0;e<t.backgrounds.length;e++){let s=0;for(let n=0;n<i.length;n++)t.backgrounds[e].aptitude==i[n]&&s++;n.push(new $e(t.backgrounds[e],s))}n.sort(((e,t)=>t.matches-e.matches));for(let e=0;e<n.length;e++)console.log(n[e].background?.background,n[e].matches,n[e].background?.aptitude)}}logMatchingRoles(e,t){if(!t.roles||0==t.roles.length)return;const s=document.getElementById("aptitudeWishlistSelect");if(s.selectedIndex>=0){console.log("logMatchingRoles");const e=s.selectedOptions,i=[],n=[];for(let t=0;t<e.length;t++)i.push(this.data.optional[e[t].index]);console.log(i);for(let e=0;e<t.roles.length;e++){let s=0;for(let n=0;n<t.roles[e].aptitudes.length;n++)for(let r=0;r<i.length;r++)t.roles[e].aptitudes[n]==i[r]&&s++;n.push(new Oe(t.roles[e],s))}n.sort(((e,t)=>t.matches-e.matches));for(let e=0;e<n.length;e++)console.log(n[e].role?.role,n[e].matches,n[e].role?.aptitudes)}}logMatchingClasses(e,t){if(!t.classes||0==t.classes.length)return;const s=document.getElementById("aptitudeWishlistSelect");if(s.selectedIndex>=0){console.log("logMatchingClasses");const e=s.selectedOptions,i=[],n=[];for(let t=0;t<e.length;t++)i.push(this.data.optional[e[t].index]);console.log(i);for(let e=0;e<t.classes.length;e++){let s=0;for(let n=0;n<t.classes[e].aptitudes.length;n++)for(let r=0;r<i.length;r++)t.classes[e].aptitudes[n]==i[r]&&s++;n.push(new We(t.classes[e],s))}n.sort(((e,t)=>t.matches-e.matches));for(let e=0;e<n.length;e++)console.log(n[e].class?.class,n[e].matches,n[e].class?.aptitudes)}}styleAptitudeMatches(e,t){for(let e=0;e<t.optional.length;e++){const s=t.optional[e];let i=document.getElementById("style-"+s.replace(" ","_"));i||(i=document.createElement("style"),i.id="style-"+s.replace(" ","_"),i.innerHTML=".badge.badge-pill.badge-secondary."+s.replace(" ","_")+"{background-color:#1cc88a !important}",document.body.appendChild(i)),i.disabled=!0}const s=document.getElementById("aptitudeWishlistSelect");if(this.configData.aptitudesWishlist=[],s.selectedIndex>=0){const e=s.selectedOptions;for(let t=0;t<e.length;t++){const s=this.data.optional[e[t].index];this.configData.aptitudesWishlist.push(s),document.getElementById("style-"+s.replace(" ","_")).disabled=!1}}this.save()}logPrerequisiteTree(e,t){t.and.length>0?(console.log(e+"AND"),t.and.forEach((t=>{this.logPrerequisiteTree(e+"  ",t),null!=t.talentPick&&this.logPrerequisiteTree(e+"    ",t.talentPick.talent.prerequisiteTree)}))):t.or.length>0?(console.log(e+"OR"),t.or.forEach((t=>{this.logPrerequisiteTree(e+"  ",t),null!=t.talentPick&&this.logPrerequisiteTree(e+"    ",t.talentPick.talent.prerequisiteTree)}))):null!=t.talentPick?console.log(e+"T: "+t.talentPick):null!=t.skillPick?console.log(e+"S: "+t.skillPick):null!=t.characteristicPick?console.log(e+"C: "+t.characteristicPick):null!=t.text&&""!=t.text&&console.log(e+"*: "+t.text)}newPrerequisitesAsList(e,t){const s=[];this.flattenPrerequisitesAsList(e,s);const i=t.appendChild(document.createElement("ul"));return s.forEach((e=>{const t=this.prerequisiteToString(e);null!=t&&(i.appendChild(document.createElement("li")).innerHTML=t)})),t}flattenPrerequisitesAsList(e,t){null!=e.and&&e.and.length>0?e.and.forEach((e=>{this.flattenPrerequisitesAsListEach(t,e)})):null!=e.or&&e.or.length>0?e.or.forEach((e=>{this.flattenPrerequisitesAsListEach(t,e)})):this.flattenPrerequisitesAsListEach(t,e)}flattenPrerequisitesAsListEach(e,t){let s=!1;t.characteristicPick?e.filter((e=>e.characteristicPick&&t.characteristicPick&&e.characteristicPick.characteristic==t.characteristicPick.characteristic)).forEach((e=>{e.characteristicPick.amount=Math.max(e.characteristicPick.amount,t.characteristicPick.amount),s=!0})):t.skillPick?e.filter((e=>e.skillPick&&t.skillPick&&e.skillPick.skill==t.skillPick.skill&&e.skillPick.choices===t.skillPick.choices)).forEach((e=>{e.skillPick.amount=Math.max(e.skillPick.amount,t.skillPick.amount),s=!0})):t.talentPick?e.filter((e=>e.talentPick&&t.talentPick&&e.talentPick.talent==t.talentPick.talent&&e.talentPick.choices===t.talentPick.choices)).forEach((e=>{s=!0})):e.filter((e=>e.text&&t.text&&e.text==t.text)).forEach((e=>{s=!0})),s||e.push(t),null!=t.talentPick&&this.flattenPrerequisitesAsList(t.talentPick.talent.prerequisiteTree,e)}prerequisiteToString(e){return e.and&&e.and.length>0||e.or&&e.or.length>0?null:e.characteristicPick?e.characteristicPick.toString():e.skillPick?e.skillPick.toString():e.talentPick?e.talentPick.toString():e.text?e.text:null}newPrerequisitesAsTree(e,t){if(this.newPrerequisitesAsTreeIterate(e,t),!t.innerHTML.includes("ul")){const e=document.createElement("li");e.innerHTML=t.innerHTML;const s=document.createElement("ul");for(s.appendChild(e);t.firstChild;)t.removeChild(t.firstChild);t.appendChild(s)}return t}newPrerequisitesAsTreeIterate(e,t){if(null!=e.and&&e.and.length>0){const s=t.appendChild(document.createElement("ul"));e.and.forEach((e=>{const t=this.prerequisiteToString(e),i=document.createElement("li");null!=t&&(s.appendChild(i).innerHTML=t),null!=e.talentPick&&this.newPrerequisitesAsTreeIterate(e.talentPick.talent.prerequisiteTree,i)}))}else if(null!=e.or&&e.or.length>0){const s=t.appendChild(document.createElement("ul"));e.or.forEach((e=>{const t=this.prerequisiteToString(e),i=document.createElement("li");null!=t&&(s.appendChild(i).innerHTML=t),null!=e.talentPick&&this.newPrerequisitesAsTreeIterate(e.talentPick.talent.prerequisiteTree,i)}))}else{const s=this.prerequisiteToString(e);if(null!=s||null!=e.talentPick){const i=t.appendChild(document.createElement("ul")),n=document.createElement("li");null!=s&&(i.appendChild(n).innerHTML=s),null!=e.talentPick&&this.newPrerequisitesAsTreeIterate(e.talentPick.talent.prerequisiteTree,n)}}return t}}).start()}();
//# sourceMappingURL=w40k.js.map