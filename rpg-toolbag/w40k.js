!function(){"use strict";var e;!function(e){e.General="General",e.Weapon_Skill="Weapon Skill",e.Ballistic_Skill="Ballistic Skill",e.Strength="Strength",e.Toughness="Toughness",e.Agility="Agility",e.Intelligence="Intelligence",e.Perception="Perception",e.Willpower="Willpower",e.Fellowship="Fellowship",e.Offence="Offence",e.Finesse="Finesse",e.Defence="Defence",e.Psyker="Psyker",e.Tech="Tech",e.Knowledge="Knowledge",e.Leadership="Leadership",e.Fieldcraft="Fieldcraft",e.Social="Social"}(e||(e={}));class t{class=null;matches=0;constructor(e,t){this.class=e,this.matches=t}}class s{role=null;matches=0;constructor(e,t){this.role=e,this.matches=t}}class l{world=null;matches=0;constructor(e,t){this.world=e,this.matches=t}}class n{background=null;matches=0;constructor(e,t){this.background=e,this.matches=t}}class d{wishlist;skill_wishlist;skip0CbChecked;worldSelected;classSelected;backgroundSelected;roleSelected;extraAptitudesSelected;aptitudesWishlist;constructor(){this.wishlist="",this.skill_wishlist="",this.skip0CbChecked=!1,this.worldSelected="",this.classSelected="",this.backgroundSelected="",this.roleSelected="",this.extraAptitudesSelected=[],this.aptitudesWishlist=[]}}(new class{init(){const e=window.location.search,t=new URLSearchParams(e).get("source")||"ow";fetch("assets/w40k-"+t+".json").then((e=>e.json())).then((e=>this.app(e,t)))}data;configData=new d;selectedAptitudes=[];source="ow";app(e,t){this.data=e,this.source=t;const s=localStorage.getItem("w40k-data-config-"+t);s&&(console.log("load","w40k-data-config-"+this.source,s),this.configData=JSON.parse(s));const l=document.getElementById("classSelectContainer");if(this.data.classes&&this.data.classes.length>0){const e=document.getElementById("classSelect");{const t=document.createElement("option");t.text="None",e.add(t)}for(let t=0;t<this.data.classes.length;t++){const s=document.createElement("option"),l=this.data.classes[t].aptitudes,{apt:n,aptalt:d}=this.commonFunc2(l);s.text=this.data.classes[t].class+" ("+n.trim()+")",s.setAttribute("data-content",this.data.classes[t].class+" "+d),s.value=this.data.classes[t].class,this.configData.classSelected&&this.configData.classSelected==this.data.classes[t].class&&(s.selected=!0),e.add(s)}e.addEventListener("change",(e=>{this.triggerRecalc(e)}))}else l.style.display="none";const n=document.getElementById("worldSelectContainer");if(this.data.worlds&&this.data.worlds.length>0){const e=document.getElementById("worldSelect");{const t=document.createElement("option");t.text="None",e.add(t)}for(let t=0;t<this.data.worlds.length;t++){const s=document.createElement("option");s.text=this.data.worlds[t].world+" ("+this.data.worlds[t].aptitude+")",s.setAttribute("data-content",this.data.worlds[t].world+" <span class='badge badge-pill badge-secondary "+this.data.worlds[t].aptitude.replace(" ","_")+"'>"+this.data.worlds[t].aptitude+"</span>"),s.value=this.data.worlds[t].world,this.configData.worldSelected&&this.configData.worldSelected==this.data.worlds[t].world&&(s.selected=!0),e.add(s)}e.addEventListener("change",(e=>{this.triggerRecalc(e)}))}else n.style.display="none";const d=document.getElementById("backgroundSelectContainer");if(this.data.backgrounds&&this.data.backgrounds.length>0){const e=document.getElementById("backgroundSelect");{const t=document.createElement("option");t.text="None",e.add(t)}for(let t=0;t<this.data.backgrounds.length;t++){const s=document.createElement("option");s.text=this.data.backgrounds[t].background+" ("+this.data.backgrounds[t].aptitude+")",s.setAttribute("data-content",this.data.backgrounds[t].background+" <span class='badge badge-pill badge-secondary "+this.data.backgrounds[t].aptitude.replace(" ","_")+"'>"+this.data.backgrounds[t].aptitude+"</span>"),s.value=this.data.backgrounds[t].background,this.configData.backgroundSelected&&this.configData.backgroundSelected==this.data.backgrounds[t].background&&(s.selected=!0),e.add(s)}e.addEventListener("change",(e=>{this.triggerRecalc(e)}))}else d.style.display="none";const i=document.getElementById("roleSelectContainer");if(this.data.roles&&this.data.roles.length>0){const e=document.getElementById("roleSelect");{const t=document.createElement("option");t.text="None",e.add(t)}for(let t=0;t<this.data.roles.length;t++){const s=document.createElement("option"),l=this.data.roles[t].aptitudes,{apt:n,aptalt:d}=this.commonFunc2(l);s.text=this.data.roles[t].role+" ("+n.trim()+")",s.setAttribute("data-content",this.data.roles[t].role+" "+d),s.value=this.data.roles[t].role,this.configData.roleSelected&&this.configData.roleSelected==this.data.roles[t].role&&(s.selected=!0),e.add(s)}e.addEventListener("change",(e=>{this.triggerRecalc(e)}))}else i.style.display="none";const c=document.getElementById("aptitudeSelect");for(let e=0;e<this.data.optional.length;e++){const t=document.createElement("option");t.text=this.data.optional[e],t.value=this.data.optional[e],this.configData.extraAptitudesSelected&&this.configData.extraAptitudesSelected.includes(this.data.optional[e])&&(t.selected=!0),c.add(t)}c.addEventListener("change",(e=>{this.triggerRecalc(e)}));const a=document.getElementById("aptitudeWishlistSelect");for(let e=0;e<this.data.optional.length;e++){const t=document.createElement("option");t.text=this.data.optional[e],t.value=this.data.optional[e],this.configData.aptitudesWishlist&&this.configData.aptitudesWishlist.includes(this.data.optional[e])&&(t.selected=!0),a.add(t)}a.addEventListener("change",(t=>{this.logMatchingClasses(t,e),this.logMatchingWorlds(t,e),this.logMatchingBackgrounds(t,e),this.logMatchingRoles(t,e),this.styleAptitudeMatches(t,e)}));const o=document.getElementById("skip0Cb");o.checked=this.configData.skip0CbChecked,o.addEventListener("change",(e=>{this.triggerRecalc(e)}));const r=document.getElementById("wishlist");r.value=this.configData.wishlist,r.addEventListener("change",(e=>{this.triggerRecalc(e)}));const h=document.getElementById("skill_wishlist");h.value=this.configData.skill_wishlist,h.addEventListener("change",(e=>{this.triggerRecalc(e)})),document.getElementById("export_characteristic").addEventListener("click",(e=>{this.copyToClipboard("characteristic")})),document.getElementById("export_skill").addEventListener("click",(e=>{this.copyToClipboard("skill")})),document.getElementById("export_talent").addEventListener("click",(e=>{this.copyToClipboard("talent")})),document.getElementById("export_talent_wishlist").addEventListener("click",(e=>{this.copyToClipboardWishlist()})),document.getElementById("export_all").addEventListener("click",(e=>{this.exportAllTableToExcelDef("characteristic","skill","talent")})),document.getElementById("wishlist_clear").addEventListener("click",(e=>{r.value="",this.triggerRecalc(e)})),document.getElementById("skill_wishlist_clear").addEventListener("click",(e=>{h.value="",this.triggerRecalc(e)})),$("._selectpicker").selectpicker(),this.triggerRecalc(null),this.styleAptitudeMatches(null,e)}commonFunc2(e){let t="",s="";for(let l=0;l<e.length;l++)t+=e[l],s+="<span class='badge badge-pill badge-secondary "+e[l].replace(" ","_")+"'>"+e[l]+"</span>",l<e.length-1&&(t+=", ");return{apt:t,aptalt:s}}triggerRecalc(e){console.log("triggerRecalc");const t=document.getElementById("wishlist");this.configData.wishlist=t.value;const s=t.value.split("\n");for(let e=0;e<s.length;e++)""===s[e]&&(s.splice(e,1),e--);for(let e=0;e<s.length;e++)s[e]=s[e].toLowerCase().trim();const l=document.getElementById("skill_wishlist");this.configData.skill_wishlist=l.value;const n=l.value.split("\n");for(let e=0;e<n.length;e++)""===n[e]&&(n.splice(e,1),e--);for(let e=0;e<n.length;e++)n[e]=n[e].toLowerCase().trim();this.selectedAptitudes=[];const d=document.getElementById("skip0Cb");this.configData.skip0CbChecked=d.checked;const i=d.checked;this.selectedAptitudes.push(this.data.free);const c=[],a=document.getElementById("classSelect");if(a.selectedIndex>0){const e=this.data.classes[a.selectedIndex-1],t=e.aptitudes;this.configData.classSelected=e.class;for(let e=0;e<t.length;e++)console.log("classSelect",t[e]),this.selectedAptitudes.includes(t[e])?c.push(t[e]):this.selectedAptitudes.push(t[e])}else this.configData.classSelected="";const o=document.getElementById("worldSelect");if(o.selectedIndex>0){const e=this.data.worlds[o.selectedIndex-1],t=e.aptitude;this.configData.worldSelected=e.world,console.log("worldSelect",t),this.selectedAptitudes.includes(t)?c.push(t):this.selectedAptitudes.push(t)}else this.configData.worldSelected="";const r=document.getElementById("roleSelect");if(r.selectedIndex>0){const e=this.data.roles[r.selectedIndex-1],t=e.aptitudes;this.configData.roleSelected=e.role;for(let e=0;e<t.length;e++)console.log("roleSelect",t[e]),this.selectedAptitudes.includes(t[e])?c.push(t[e]):this.selectedAptitudes.push(t[e])}else this.configData.roleSelected="";const h=document.getElementById("backgroundSelect");if(h.selectedIndex>0){const e=this.data.backgrounds[h.selectedIndex-1],t=e.aptitude;this.configData.backgroundSelected=e.background,console.log("backgroundSelect",t),this.selectedAptitudes.includes(t)?c.push(t):this.selectedAptitudes.push(t)}else this.configData.backgroundSelected="";const u=document.getElementById("aptitudeSelect");if(this.configData.extraAptitudesSelected=[],u.selectedIndex>=0){const e=u.selectedOptions;for(let t=0;t<e.length;t++){const s=this.data.optional[e[t].index];this.configData.extraAptitudesSelected.push(s),console.log("aptitudeSelect",s),this.selectedAptitudes.includes(s)?c.push(s):this.selectedAptitudes.push(s)}}const p=document.getElementById("selectedAptitudes");p.innerHTML="";for(let e=0;e<this.selectedAptitudes.length;e++)p.innerHTML+="<span class='badge badge-pill badge-secondary "+this.selectedAptitudes[e].replace(" ","_")+"'>"+this.selectedAptitudes[e]+"</span>&nbsp;";for(let e=0;e<c.length;e++)p.innerHTML+="<span class='badge badge-pill badge-danger'>"+c[e]+" (duplicate)</span>";const g=document.getElementById("characteristic");g.innerHTML="";const m=this.data.characteristic.sort(((e,t)=>{let s=0;this.selectedAptitudes.includes(e.name)&&s++,this.selectedAptitudes.includes(e.aptitude)&&s++;let l=0;return this.selectedAptitudes.includes(t.name)&&l++,this.selectedAptitudes.includes(t.aptitude)&&l++,-s+l}));for(let e=0;e<m.length;e++){const t=document.createElement("div"),s=document.createElement("div");let l=!1;for(let n=0;n<this.data.costs.length;n++)if("characteristic"===this.data.costs[n].type){let d=0;this.selectedAptitudes.includes(m[e].name)&&d++,this.selectedAptitudes.includes(m[e].aptitude)&&d++,l=this.commonFunc1(t,n,d,s,i,l)}if(l)continue;const n=document.createElement("div");g.appendChild(n),n.appendChild(t),n.appendChild(s);const d=document.createElement("div");d.innerHTML=m[e].name,this.selectedAptitudes.includes(m[e].name)&&d.classList.add("m2"),n.appendChild(d);const c=document.createElement("div");c.innerHTML=m[e].aptitude,this.selectedAptitudes.includes(m[e].aptitude)&&c.classList.add("m2"),n.appendChild(c)}const f=document.getElementById("talent");f.innerHTML="";const b=this.data.talents.sort(((e,t)=>{let s=0;this.selectedAptitudes.includes(e.apt1)&&s++,this.selectedAptitudes.includes(e.apt2)&&s++;let l=0;return this.selectedAptitudes.includes(t.apt1)&&l++,this.selectedAptitudes.includes(t.apt2)&&l++,s===l?e.tier-t.tier:-s+l}));for(let e=0;e<b.length;e++){if(0!=s.length&&!s.includes(b[e].talent.toLowerCase().trim()))continue;const t=document.createElement("div"),l=document.createElement("div");let n=!1;for(let s=0;s<this.data.costs.length;s++)if("talent"===this.data.costs[s].type){let d=0;this.selectedAptitudes.includes(b[e].apt1)&&d++,this.selectedAptitudes.includes(b[e].apt2)&&d++,t.innerHTML=""+this.data.costs[s].cost[2-d][b[e].tier-1],t.classList.add("m"+d),l.innerHTML=""+d,l.classList.add("m"+d),0===d&&i&&(n=!0)}if(n)continue;const d=document.createElement("div");f.appendChild(d),d.appendChild(t),d.appendChild(l);const c=document.createElement("div");c.innerHTML="T"+b[e].tier,d.appendChild(c);const a=document.createElement("div");a.innerHTML=b[e].talent,d.appendChild(a),a.title=b[e].benefit,b[e].ref&&(a.title+=" ( "+b[e].ref.replace("PG","").trim()+" )");const o=document.createElement("div");o.innerHTML=b[e].apt1,d.appendChild(o),this.selectedAptitudes.includes(b[e].apt1)&&o.classList.add("m2");const r=document.createElement("div");r.innerHTML=b[e].apt2,d.appendChild(r),this.selectedAptitudes.includes(b[e].apt2)&&r.classList.add("m2");const h=document.createElement("div");h.innerHTML=b[e].prerequisites,d.appendChild(h);const u=document.createElement("div");u.innerHTML=b[e].benefit,u.style.display="none",d.appendChild(u)}const E=document.getElementById("skill");E.innerHTML="";const y=this.data.skills.sort(((e,t)=>{let s=0;this.selectedAptitudes.includes(e.aptitudes[0])&&s++,this.selectedAptitudes.includes(e.aptitudes[1])&&s++;let l=0;return this.selectedAptitudes.includes(t.aptitudes[0])&&l++,this.selectedAptitudes.includes(t.aptitudes[1])&&l++,-s+l}));for(let e=0;e<y.length;e++){if(0!=n.length&&!n.includes(y[e].name.toLowerCase().trim()))continue;const t=document.createElement("div"),s=document.createElement("div");let l=!1;for(let n=0;n<this.data.costs.length;n++)if("skill"===this.data.costs[n].type){let d=0;this.selectedAptitudes.includes(y[e].aptitudes[0])&&d++,this.selectedAptitudes.includes(y[e].aptitudes[1])&&d++,l=this.commonFunc1(t,n,d,s,i,l)}if(l)continue;const d=document.createElement("div");E.appendChild(d),d.appendChild(t),d.appendChild(s);const c=document.createElement("div");c.innerHTML=y[e].name,d.appendChild(c);for(let t=0;t<y[e].aptitudes.length;t++){const s=document.createElement("div");s.innerHTML=y[e].aptitudes[t],this.selectedAptitudes.includes(y[e].aptitudes[t])&&s.classList.add("m2"),d.appendChild(s)}}$("[title]:not(.dropdown-toggle)").tooltip(),this.save()}save(){const e=JSON.stringify(this.configData);console.log("save","w40k-data-config-"+this.source,e),localStorage.setItem("w40k-data-config-"+this.source,e)}commonFunc1(e,t,s,l,n,d){return e.innerHTML=""+this.data.costs[t].cost[2-s][0],e.classList.add("m"+s),l.innerHTML=""+s,l.classList.add("m"+s),0===s&&n&&(d=!0),d}exportAllTableToExcelDef(e,t,s){document.getElementById("exportTableToExcelDef")?.remove();const l=this.exportDivToTable(e),n=this.exportDivToTable(t),d=this.exportDivToTable(s);if(!l)return;if(!n)return;if(!d)return;const i=document.createElement("div");i.innerHTML="<table><tr><td>Characteristics</td></tr>\t<tr>\n\t\t<td>cost</td>\n\t\t<td>m</td>\n\t\t<td>skill</td>\n\t\t<td>aptitude</td>\n\t</tr>"+l.replace("<table>","").replace("</table>","")+"<tr><td> </td></tr><tr><td> </td></tr><tr><td>Skills</td></tr>\t<tr>\n\t\t<td>cost</td>\n\t\t<td>m</td>\n\t\t<td>characteristic</td>\n\t\t<td>aptitude</td>\n\t\t<td>aptitude</td>\n\t</tr>"+n.replace("<table>","").replace("</table>","")+"<tr><td> </td></tr><tr><td> </td></tr><tr><td>Talents</td></tr>\t<tr>\n\t\t<td>cost</td>\n\t\t<td>m</td>\n\t\t<td>tier</td>\n\t\t<td>talent</td>\n\t\t<td>aptitude</td>\n\t\t<td>aptitude</td>\n\t\t<td>requirement</td>\n\t\t<td>description</td>\n\t</tr>"+d.replace("<table>","").replace("</table>","")+"</table>",i.style.display="none",i.id="exportTableToExcelDef",document.body.appendChild(i),this.exportTableToExcel("exportTableToExcelDef","all")}exportTableToExcelDef(e){document.getElementById("exportTableToExcelDef")?.remove();const t=this.exportDivToTable(e);if(!t)return;const s=document.createElement("div");s.innerHTML=t,s.style.display="none",s.id="exportTableToExcelDef",document.body.appendChild(s),this.exportTableToExcel("exportTableToExcelDef",e)}exportDivToTable(e,t=!1){const s=document.getElementById(e);if(!s)return;let l="";t||(l+="<table>");for(let e=0;e<s.children.length;e++){t||(l+="<tr>");const n=s.children[e];for(let e=0;e<n.children.length;e++)t||(l+="<td>"),l+=n.children[e].innerHTML,l+=t?"\t":"</td>";l+=t?"\n":"</tr>"}return t||(l+="</table>"),l}exportTableToExcel(e,t=""){const s="application/vnd.ms-excel",l=document.getElementById(e);if(!l)return;const n=l.outerHTML.replace(/ /g,"%20");t=t?t+".xls":"excel_data.xls",document.getElementById("a789")?.remove();const d=document.createElement("a");if(d.id="a789",document.body.appendChild(d),navigator.msSaveOrOpenBlob){const e=new Blob(["\ufeff",n],{type:s});navigator.msSaveOrOpenBlob(e,t)}else d.href="data:"+s+", "+n,d.download=t,d.click()}copyToClipboard(e){const t=this.exportDivToTable(e,!0);if(!t)return;document.getElementById("textarea123")?.remove();const s=document.createElement("textarea");s.innerHTML=t,s.style.display="none",s.id="textarea123",document.body.appendChild(s),s.select(),s.setSelectionRange(0,99999),navigator.clipboard.writeText(s.value)}copyToClipboardWishlist(){const e=document.getElementById("talent");if(!e)return;let t="";for(let s=0;s<e.children.length;s++){const l=e.children[s];("0"==l.children[1].innerHTML||"1"==l.children[1].innerHTML)&&(t+=l.children[3].innerHTML+"\n")}document.getElementById("textarea456aa")?.remove();const s=document.createElement("textarea");s.innerHTML=t,s.style.display="none",s.id="textarea456aa",document.body.appendChild(s),s.select(),s.setSelectionRange(0,99999),console.log(s.value),navigator.clipboard.writeText(s.value)}logMatchingWorlds(e,t){if(!t.worlds||0==t.worlds.length)return;const s=document.getElementById("aptitudeWishlistSelect");if(s.selectedIndex>=0){console.log("logMatchingWorlds");const e=s.selectedOptions,n=[],d=[];for(let t=0;t<e.length;t++){const s=this.data.optional[e[t].index];n.push(s)}console.log(n);for(let e=0;e<t.worlds.length;e++){const s=t.worlds[e];let i=0;const c=s.aptitude;for(let e=0;e<n.length;e++)c==n[e]&&i++;const a=new l(s,i);d.push(a)}d.sort(((e,t)=>t.matches-e.matches));for(let e=0;e<d.length;e++)console.log(d[e].world?.world,d[e].matches,d[e].world?.aptitude)}}logMatchingBackgrounds(e,t){if(!t.backgrounds||0==t.backgrounds.length)return;const s=document.getElementById("aptitudeWishlistSelect");if(s.selectedIndex>=0){console.log("logMatchingBackgrounds");const e=s.selectedOptions,l=[],d=[];for(let t=0;t<e.length;t++){const s=this.data.optional[e[t].index];l.push(s)}console.log(l);for(let e=0;e<t.backgrounds.length;e++){const s=t.backgrounds[e];let i=0;const c=s.aptitude;for(let e=0;e<l.length;e++)c==l[e]&&i++;const a=new n(s,i);d.push(a)}d.sort(((e,t)=>t.matches-e.matches));for(let e=0;e<d.length;e++)console.log(d[e].background?.background,d[e].matches,d[e].background?.aptitude)}}logMatchingRoles(e,t){if(!t.roles||0==t.roles.length)return;const l=document.getElementById("aptitudeWishlistSelect");if(l.selectedIndex>=0){console.log("logMatchingRoles");const e=l.selectedOptions,n=[],d=[];for(let t=0;t<e.length;t++){const s=this.data.optional[e[t].index];n.push(s)}console.log(n);for(let e=0;e<t.roles.length;e++){const l=t.roles[e];let i=0;for(let e=0;e<l.aptitudes.length;e++){const t=l.aptitudes[e];for(let e=0;e<n.length;e++)t==n[e]&&i++}const c=new s(l,i);d.push(c)}d.sort(((e,t)=>t.matches-e.matches));for(let e=0;e<d.length;e++)console.log(d[e].role?.role,d[e].matches,d[e].role?.aptitudes)}}logMatchingClasses(e,s){if(!s.classes||0==s.classes.length)return;const l=document.getElementById("aptitudeWishlistSelect");if(l.selectedIndex>=0){console.log("logMatchingClasses");const e=l.selectedOptions,n=[],d=[];for(let t=0;t<e.length;t++){const s=this.data.optional[e[t].index];n.push(s)}console.log(n);for(let e=0;e<s.classes.length;e++){const l=s.classes[e];let i=0;for(let e=0;e<l.aptitudes.length;e++){const t=l.aptitudes[e];for(let e=0;e<n.length;e++)t==n[e]&&i++}const c=new t(l,i);d.push(c)}d.sort(((e,t)=>t.matches-e.matches));for(let e=0;e<d.length;e++)console.log(d[e].class?.class,d[e].matches,d[e].class?.aptitudes)}}styleAptitudeMatches(e,t){for(let e=0;e<t.optional.length;e++){const s=t.optional[e];let l=document.getElementById("style-"+s.replace(" ","_"));l?l.disabled=!0:(l=document.createElement("style"),l.id="style-"+s.replace(" ","_"),l.innerHTML=".badge.badge-pill.badge-secondary."+s.replace(" ","_")+"{background-color:#1cc88a !important}",document.body.appendChild(l),l.disabled=!0,console.log(l))}const s=document.getElementById("aptitudeWishlistSelect");if(this.configData.aptitudesWishlist=[],s.selectedIndex>=0){const e=s.selectedOptions;for(let t=0;t<e.length;t++){const s=this.data.optional[e[t].index];this.configData.aptitudesWishlist.push(s);const l=document.getElementById("style-"+s.replace(" ","_"));l.disabled=!1,console.log(l)}}this.save()}}).init()}();
//# sourceMappingURL=w40k.js.map