!function(){"use strict";var e;!function(e){e.General="General",e.Weapon_Skill="Weapon Skill",e.Ballistic_Skill="Ballistic Skill",e.Strength="Strength",e.Toughness="Toughness",e.Agility="Agility",e.Intelligence="Intelligence",e.Perception="Perception",e.Willpower="Willpower",e.Fellowship="Fellowship",e.Offence="Offence",e.Finesse="Finesse",e.Defence="Defence",e.Psyker="Psyker",e.Tech="Tech",e.Knowledge="Knowledge",e.Leadership="Leadership",e.Fieldcraft="Fieldcraft",e.Social="Social"}(e||(e={})),(new class{init(){const e=window.location.search,t=new URLSearchParams(e);let n=t.get("source");n||(n="ow"),console.log(t,n,"ow"==n),fetch("assets/w40k-"+n+".json").then((e=>e.json())).then((e=>this.app(e,"ow"==n)))}data;selectedAptitudes=[];app(e,t){this.data=e,document.getElementById("classSelectContainer").style.display=t?"block":"none";const n=document.getElementById("classSelect");{const e=document.createElement("option");e.text="None",n.add(e)}for(let e=0;e<this.data.classes.length;e++){const t=document.createElement("option");t.text=this.data.classes[e].class,t.value=this.data.classes[e].class,n.add(t)}n.addEventListener("change",(e=>{this.triggerRecalc(e)}));const d=document.getElementById("aptitudeSelect");for(let e=0;e<this.data.optional.length;e++){const t=document.createElement("option");t.text=this.data.optional[e],t.value=this.data.optional[e],d.add(t)}d.addEventListener("change",(e=>{this.triggerRecalc(e)})),document.getElementById("skip0Cb").addEventListener("change",(e=>{this.triggerRecalc(e)})),document.getElementById("wishlist").addEventListener("change",(e=>{this.triggerRecalc(e)})),document.getElementById("export_characteristic").addEventListener("click",(e=>{this.copyToClipboard("characteristic")})),document.getElementById("export_skill").addEventListener("click",(e=>{this.copyToClipboard("skill")})),document.getElementById("export_talent").addEventListener("click",(e=>{this.copyToClipboard("talent")})),document.getElementById("export_talent_wishlist").addEventListener("click",(e=>{this.copyToClipboardWishlist()})),document.getElementById("export_all").addEventListener("click",(e=>{this.exportAllTableToExcelDef("characteristic","skill","talent")})),$("._selectpicker").selectpicker(),this.triggerRecalc(null)}triggerRecalc(e){const t=document.getElementById("wishlist").value.split("\n");for(let e=0;e<t.length;e++)""===t[e]&&(t.splice(e,1),e--);for(let e=0;e<t.length;e++)t[e]=t[e].toLowerCase().trim();this.selectedAptitudes=[];const n=document.getElementById("skip0Cb").checked;this.selectedAptitudes.push(this.data.free);const d=document.getElementById("classSelect");if(d.selectedIndex>0){const e=this.data.classes[d.selectedIndex-1].aptitudes;for(let t=0;t<e.length;t++)this.selectedAptitudes.push(e[t])}const l=[],i=document.getElementById("aptitudeSelect");if(console.log("aptitudeSelect.selectedIndex",i.selectedIndex),i.selectedIndex>=0){const e=i.selectedOptions;console.log("selectedOptions",e.length,e);for(let t=0;t<e.length;t++){const n=this.data.optional[e[t].index];console.log(e[t]),this.selectedAptitudes.includes(n)?l.push(n):this.selectedAptitudes.push(n)}}const s=document.getElementById("selectedAptitudes");s.innerHTML="";for(let e=0;e<this.selectedAptitudes.length;e++)s.innerHTML+="<span class='badge badge-secondary'>"+this.selectedAptitudes[e]+"</span>&nbsp;";for(let e=0;e<l.length;e++)s.innerHTML+="<span class='badge badge-danger'>"+l[e]+" (duplicate)</span>";const c=document.getElementById("characteristic");c.innerHTML="";const a=this.data.characteristic.sort(((e,t)=>{let n=0;this.selectedAptitudes.includes(e.name)&&n++,this.selectedAptitudes.includes(e.aptitude)&&n++;let d=0;return this.selectedAptitudes.includes(t.name)&&d++,this.selectedAptitudes.includes(t.aptitude)&&d++,-n+d}));for(let e=0;e<a.length;e++){const t=document.createElement("div"),d=document.createElement("div");let l=!1;for(let i=0;i<this.data.costs.length;i++)if("characteristic"===this.data.costs[i].type){let s=0;this.selectedAptitudes.includes(a[e].name)&&s++,this.selectedAptitudes.includes(a[e].aptitude)&&s++,t.innerHTML=""+this.data.costs[i].cost[2-s][0],t.classList.add("m"+s),d.innerHTML=""+s,d.classList.add("m"+s),0===s&&n&&(l=!0)}if(l)continue;const i=document.createElement("div");c.appendChild(i),i.appendChild(t),i.appendChild(d);const s=document.createElement("div");s.innerHTML=a[e].name,this.selectedAptitudes.includes(a[e].name)&&s.classList.add("m2"),i.appendChild(s);const o=document.createElement("div");o.innerHTML=a[e].aptitude,this.selectedAptitudes.includes(a[e].aptitude)&&o.classList.add("m2"),i.appendChild(o)}const o=document.getElementById("talent");o.innerHTML="";const r=this.data.talents.sort(((e,t)=>{let n=0;this.selectedAptitudes.includes(e.apt1)&&n++,this.selectedAptitudes.includes(e.apt2)&&n++;let d=0;return this.selectedAptitudes.includes(t.apt1)&&d++,this.selectedAptitudes.includes(t.apt2)&&d++,n===d?e.tier-t.tier:-n+d}));for(let e=0;e<r.length;e++){if(0!=t.length&&!t.includes(r[e].talent.toLowerCase().trim()))continue;const d=document.createElement("div"),l=document.createElement("div");let i=!1;for(let t=0;t<this.data.costs.length;t++)if("talent"===this.data.costs[t].type){let s=0;this.selectedAptitudes.includes(r[e].apt1)&&s++,this.selectedAptitudes.includes(r[e].apt2)&&s++,d.innerHTML=""+this.data.costs[t].cost[2-s][r[e].tier-1],d.classList.add("m"+s),l.innerHTML=""+s,l.classList.add("m"+s),0===s&&n&&(i=!0)}if(i)continue;const s=document.createElement("div");o.appendChild(s),s.appendChild(d),s.appendChild(l);const c=document.createElement("div");c.innerHTML="T"+r[e].tier,s.appendChild(c);const a=document.createElement("div");a.innerHTML=r[e].talent,s.appendChild(a),a.title=r[e].benefit;const p=document.createElement("div");p.innerHTML=r[e].apt1,s.appendChild(p),this.selectedAptitudes.includes(r[e].apt1)&&p.classList.add("m2");const u=document.createElement("div");u.innerHTML=r[e].apt2,s.appendChild(u),this.selectedAptitudes.includes(r[e].apt2)&&u.classList.add("m2");const h=document.createElement("div");h.innerHTML=r[e].prerequisites,s.appendChild(h);const m=document.createElement("div");m.innerHTML=r[e].benefit,m.style.display="none",s.appendChild(m)}const p=document.getElementById("skill");p.innerHTML="";const u=this.data.skills.sort(((e,t)=>{let n=0;this.selectedAptitudes.includes(e.aptitudes[0])&&n++,this.selectedAptitudes.includes(e.aptitudes[1])&&n++;let d=0;return this.selectedAptitudes.includes(t.aptitudes[0])&&d++,this.selectedAptitudes.includes(t.aptitudes[1])&&d++,-n+d}));for(let e=0;e<u.length;e++){let t=!1;const d=document.createElement("div"),l=document.createElement("div");for(let i=0;i<this.data.costs.length;i++)if("skill"===this.data.costs[i].type){let s=0;this.selectedAptitudes.includes(u[e].aptitudes[0])&&s++,this.selectedAptitudes.includes(u[e].aptitudes[1])&&s++,d.innerHTML=""+this.data.costs[i].cost[2-s][0],d.classList.add("m"+s),l.innerHTML=""+s,l.classList.add("m"+s),0===s&&n&&(t=!0)}if(t)continue;const i=document.createElement("div");p.appendChild(i),i.appendChild(d),i.appendChild(l);const s=document.createElement("div");s.innerHTML=u[e].name,i.appendChild(s);for(let t=0;t<u[e].aptitudes.length;t++){const n=document.createElement("div");n.innerHTML=u[e].aptitudes[t],this.selectedAptitudes.includes(u[e].aptitudes[t])&&n.classList.add("m2"),i.appendChild(n)}}$("[title]").tooltip()}exportAllTableToExcelDef(e,t,n){document.getElementById("exportTableToExcelDef")?.remove();const d=this.exportDivToTable(e),l=this.exportDivToTable(t),i=this.exportDivToTable(n);if(!d)return;if(!l)return;if(!i)return;const s=document.createElement("div");s.innerHTML="<table><tr><td>Characteristics</td></tr>\t<tr>\n\t\t<td>cost</td>\n\t\t<td>m</td>\n\t\t<td>skill</td>\n\t\t<td>aptitude</td>\n\t</tr>"+d.replace("<table>","").replace("</table>","")+"<tr><td> </td></tr><tr><td> </td></tr><tr><td>Skills</td></tr>\t<tr>\n\t\t<td>cost</td>\n\t\t<td>m</td>\n\t\t<td>characteristic</td>\n\t\t<td>aptitude</td>\n\t\t<td>aptitude</td>\n\t</tr>"+l.replace("<table>","").replace("</table>","")+"<tr><td> </td></tr><tr><td> </td></tr><tr><td>Talents</td></tr>\t<tr>\n\t\t<td>cost</td>\n\t\t<td>m</td>\n\t\t<td>tier</td>\n\t\t<td>talent</td>\n\t\t<td>aptitude</td>\n\t\t<td>aptitude</td>\n\t\t<td>requirement</td>\n\t\t<td>description</td>\n\t</tr>"+i.replace("<table>","").replace("</table>","")+"</table>",s.style.display="none",s.id="exportTableToExcelDef",document.body.appendChild(s),this.exportTableToExcel("exportTableToExcelDef","all")}exportTableToExcelDef(e){document.getElementById("exportTableToExcelDef")?.remove();const t=this.exportDivToTable(e);if(!t)return;const n=document.createElement("div");n.innerHTML=t,n.style.display="none",n.id="exportTableToExcelDef",document.body.appendChild(n),this.exportTableToExcel("exportTableToExcelDef",e)}exportDivToTable(e,t=!1){const n=document.getElementById(e);if(!n)return;let d="";t||(d+="<table>");for(let e=0;e<n.children.length;e++){t||(d+="<tr>");const l=n.children[e];for(let e=0;e<l.children.length;e++)t||(d+="<td>"),d+=l.children[e].innerHTML,d+=t?"\t":"</td>";d+=t?"\n":"</tr>"}return t||(d+="</table>"),d}exportTableToExcel(e,t=""){const n="application/vnd.ms-excel",d=document.getElementById(e);if(!d)return;const l=d.outerHTML.replace(/ /g,"%20");t=t?t+".xls":"excel_data.xls",document.getElementById("a789")?.remove();const i=document.createElement("a");if(i.id="a789",document.body.appendChild(i),navigator.msSaveOrOpenBlob){const e=new Blob(["\ufeff",l],{type:n});navigator.msSaveOrOpenBlob(e,t)}else i.href="data:"+n+", "+l,i.download=t,i.click()}copyToClipboard(e){const t=this.exportDivToTable(e,!0);if(!t)return;document.getElementById("textarea123")?.remove();const n=document.createElement("textarea");n.innerHTML=t,n.style.display="none",n.id="textarea123",document.body.appendChild(n),n.select(),n.setSelectionRange(0,99999),navigator.clipboard.writeText(n.value)}copyToClipboardWishlist(){const e=document.getElementById("talent");if(!e)return;let t="";for(let n=0;n<e.children.length;n++){const d=e.children[n];("0"==d.children[1].innerHTML||"1"==d.children[1].innerHTML)&&(t+=d.children[3].innerHTML+"\n")}document.getElementById("textarea456aa")?.remove();const n=document.createElement("textarea");n.innerHTML=t,n.style.display="none",n.id="textarea456aa",document.body.appendChild(n),n.select(),n.setSelectionRange(0,99999),console.log(n.value),navigator.clipboard.writeText(n.value)}aptitude(t){for(const n in e)if(t.replace("_","").replace(" ","")==n.replace("_","").replace(" ",""))return e[n];return null}}).init()}();
//# sourceMappingURL=w40k.js.map