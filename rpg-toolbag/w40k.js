!function(){"use strict";var e;!function(e){e.General="General",e.Weapon_Skill="Weapon Skill",e.Ballistic_Skill="Ballistic Skill",e.Strength="Strength",e.Toughness="Toughness",e.Agility="Agility",e.Intelligence="Intelligence",e.Perception="Perception",e.Willpower="Willpower",e.Fellowship="Fellowship",e.Offence="Offence",e.Finesse="Finesse",e.Defence="Defence",e.Psyker="Psyker",e.Tech="Tech",e.Knowledge="Knowledge",e.Leadership="Leadership",e.Fieldcraft="Fieldcraft",e.Social="Social"}(e||(e={}));class t{class=null;matches=0;constructor(e,t){this.class=e,this.matches=t}}(new class{init(){const e=window.location.search,t=new URLSearchParams(e);let n=t.get("source");n||(n="ow"),console.log(t,n,"ow"==n),fetch("assets/w40k-"+n+".json").then((e=>e.json())).then((e=>this.app(e)))}data;selectedAptitudes=[];app(e){this.data=e;const t=document.getElementById("classSelectContainer");if(this.data.classes&&this.data.classes.length>0){const e=document.getElementById("classSelect");{const t=document.createElement("option");t.text="None",e.add(t)}for(let t=0;t<this.data.classes.length;t++){const n=document.createElement("option"),s=this.data.classes[t].aptitudes;let d="";for(let e=0;e<s.length;e++)d+=s[e],e<s.length-1&&(d+=", ");n.text=this.data.classes[t].class+" ("+d.trim()+")",n.value=this.data.classes[t].class,e.add(n)}e.addEventListener("change",(e=>{this.triggerRecalc(e)}))}else t.style.display="none";const n=document.getElementById("worldSelectContainer");if(this.data.worlds&&this.data.worlds.length>0){const e=document.getElementById("worldSelect");{const t=document.createElement("option");t.text="None",e.add(t)}for(let t=0;t<this.data.worlds.length;t++){const n=document.createElement("option");n.text=this.data.worlds[t].world+" ("+this.data.worlds[t].aptitude+")",n.value=this.data.worlds[t].world,e.add(n)}e.addEventListener("change",(e=>{this.triggerRecalc(e)}))}else n.style.display="none";const s=document.getElementById("backgroundSelectContainer");if(this.data.backgrounds&&this.data.backgrounds.length>0){const e=document.getElementById("backgroundSelect");{const t=document.createElement("option");t.text="None",e.add(t)}for(let t=0;t<this.data.backgrounds.length;t++){const n=document.createElement("option");n.text=this.data.backgrounds[t].background+" ("+this.data.backgrounds[t].aptitude+")",n.value=this.data.backgrounds[t].background,e.add(n)}e.addEventListener("change",(e=>{this.triggerRecalc(e)}))}else s.style.display="none";const d=document.getElementById("roleSelectContainer");if(this.data.roles&&this.data.roles.length>0){const e=document.getElementById("roleSelect");{const t=document.createElement("option");t.text="None",e.add(t)}for(let t=0;t<this.data.roles.length;t++){const n=document.createElement("option"),s=this.data.roles[t].aptitudes;let d="";for(let e=0;e<s.length;e++)d+=s[e],e<s.length-1&&(d+=", ");n.text=this.data.roles[t].role+" ("+d.trim()+")",n.value=this.data.roles[t].role,e.add(n)}e.addEventListener("change",(e=>{this.triggerRecalc(e)}))}else d.style.display="none";const l=document.getElementById("aptitudeSelect");for(let e=0;e<this.data.optional.length;e++){const t=document.createElement("option");t.text=this.data.optional[e],t.value=this.data.optional[e],l.add(t)}l.addEventListener("change",(e=>{this.triggerRecalc(e)})),e.classes&&e.classes.length>0&&l.addEventListener("change",(t=>{this.logMatchingClasses(t,e)})),document.getElementById("skip0Cb").addEventListener("change",(e=>{this.triggerRecalc(e)}));const i=document.getElementById("wishlist");i.addEventListener("change",(e=>{this.triggerRecalc(e)})),document.getElementById("export_characteristic").addEventListener("click",(e=>{this.copyToClipboard("characteristic")})),document.getElementById("export_skill").addEventListener("click",(e=>{this.copyToClipboard("skill")})),document.getElementById("export_talent").addEventListener("click",(e=>{this.copyToClipboard("talent")})),document.getElementById("export_talent_wishlist").addEventListener("click",(e=>{this.copyToClipboardWishlist()})),document.getElementById("export_all").addEventListener("click",(e=>{this.exportAllTableToExcelDef("characteristic","skill","talent")})),document.getElementById("wishlist_clear").addEventListener("click",(e=>{i.value="",this.triggerRecalc(e)})),$("._selectpicker").selectpicker(),this.triggerRecalc(null)}triggerRecalc(e){const t=document.getElementById("wishlist").value.split("\n");for(let e=0;e<t.length;e++)""===t[e]&&(t.splice(e,1),e--);for(let e=0;e<t.length;e++)t[e]=t[e].toLowerCase().trim();this.selectedAptitudes=[];const n=document.getElementById("skip0Cb").checked;this.selectedAptitudes.push(this.data.free);const s=[],d=document.getElementById("classSelect");if(d.selectedIndex>0){const e=this.data.classes[d.selectedIndex-1].aptitudes;for(let t=0;t<e.length;t++)this.selectedAptitudes.push(e[t])}const l=document.getElementById("worldSelect");if(l.selectedIndex>0){const e=this.data.worlds[l.selectedIndex-1].aptitude;this.selectedAptitudes.includes(e)?s.push(e):this.selectedAptitudes.push(e)}const i=document.getElementById("roleSelect");if(i.selectedIndex>0){const e=this.data.roles[i.selectedIndex-1].aptitudes;for(let t=0;t<e.length;t++)this.selectedAptitudes.push(e[t])}const c=document.getElementById("backgroundSelect");if(c.selectedIndex>0){const e=this.data.backgrounds[c.selectedIndex-1].aptitude;this.selectedAptitudes.includes(e)?s.push(e):this.selectedAptitudes.push(e)}const a=document.getElementById("aptitudeSelect");if(console.log("aptitudeSelect.selectedIndex",a.selectedIndex),a.selectedIndex>=0){const e=a.selectedOptions;console.log("selectedOptions",e.length,e);for(let t=0;t<e.length;t++){const n=this.data.optional[e[t].index];console.log(e[t]),this.selectedAptitudes.includes(n)?s.push(n):this.selectedAptitudes.push(n)}}const o=document.getElementById("selectedAptitudes");o.innerHTML="";for(let e=0;e<this.selectedAptitudes.length;e++)o.innerHTML+="<span class='badge badge-secondary'>"+this.selectedAptitudes[e]+"</span>&nbsp;";for(let e=0;e<s.length;e++)o.innerHTML+="<span class='badge badge-danger'>"+s[e]+" (duplicate)</span>";const r=document.getElementById("characteristic");r.innerHTML="";const p=this.data.characteristic.sort(((e,t)=>{let n=0;this.selectedAptitudes.includes(e.name)&&n++,this.selectedAptitudes.includes(e.aptitude)&&n++;let s=0;return this.selectedAptitudes.includes(t.name)&&s++,this.selectedAptitudes.includes(t.aptitude)&&s++,-n+s}));for(let e=0;e<p.length;e++){const t=document.createElement("div"),s=document.createElement("div");let d=!1;for(let l=0;l<this.data.costs.length;l++)if("characteristic"===this.data.costs[l].type){let i=0;this.selectedAptitudes.includes(p[e].name)&&i++,this.selectedAptitudes.includes(p[e].aptitude)&&i++,t.innerHTML=""+this.data.costs[l].cost[2-i][0],t.classList.add("m"+i),s.innerHTML=""+i,s.classList.add("m"+i),0===i&&n&&(d=!0)}if(d)continue;const l=document.createElement("div");r.appendChild(l),l.appendChild(t),l.appendChild(s);const i=document.createElement("div");i.innerHTML=p[e].name,this.selectedAptitudes.includes(p[e].name)&&i.classList.add("m2"),l.appendChild(i);const c=document.createElement("div");c.innerHTML=p[e].aptitude,this.selectedAptitudes.includes(p[e].aptitude)&&c.classList.add("m2"),l.appendChild(c)}const u=document.getElementById("talent");u.innerHTML="";const h=this.data.talents.sort(((e,t)=>{let n=0;this.selectedAptitudes.includes(e.apt1)&&n++,this.selectedAptitudes.includes(e.apt2)&&n++;let s=0;return this.selectedAptitudes.includes(t.apt1)&&s++,this.selectedAptitudes.includes(t.apt2)&&s++,n===s?e.tier-t.tier:-n+s}));for(let e=0;e<h.length;e++){if(0!=t.length&&!t.includes(h[e].talent.toLowerCase().trim()))continue;const s=document.createElement("div"),d=document.createElement("div");let l=!1;for(let t=0;t<this.data.costs.length;t++)if("talent"===this.data.costs[t].type){let i=0;this.selectedAptitudes.includes(h[e].apt1)&&i++,this.selectedAptitudes.includes(h[e].apt2)&&i++,s.innerHTML=""+this.data.costs[t].cost[2-i][h[e].tier-1],s.classList.add("m"+i),d.innerHTML=""+i,d.classList.add("m"+i),0===i&&n&&(l=!0)}if(l)continue;const i=document.createElement("div");u.appendChild(i),i.appendChild(s),i.appendChild(d);const c=document.createElement("div");c.innerHTML="T"+h[e].tier,i.appendChild(c);const a=document.createElement("div");a.innerHTML=h[e].talent,i.appendChild(a),a.title=h[e].benefit;const o=document.createElement("div");o.innerHTML=h[e].apt1,i.appendChild(o),this.selectedAptitudes.includes(h[e].apt1)&&o.classList.add("m2");const r=document.createElement("div");r.innerHTML=h[e].apt2,i.appendChild(r),this.selectedAptitudes.includes(h[e].apt2)&&r.classList.add("m2");const p=document.createElement("div");p.innerHTML=h[e].prerequisites,i.appendChild(p);const m=document.createElement("div");m.innerHTML=h[e].benefit,m.style.display="none",i.appendChild(m)}const m=document.getElementById("skill");m.innerHTML="";const g=this.data.skills.sort(((e,t)=>{let n=0;this.selectedAptitudes.includes(e.aptitudes[0])&&n++,this.selectedAptitudes.includes(e.aptitudes[1])&&n++;let s=0;return this.selectedAptitudes.includes(t.aptitudes[0])&&s++,this.selectedAptitudes.includes(t.aptitudes[1])&&s++,-n+s}));for(let e=0;e<g.length;e++){let t=!1;const s=document.createElement("div"),d=document.createElement("div");for(let l=0;l<this.data.costs.length;l++)if("skill"===this.data.costs[l].type){let i=0;this.selectedAptitudes.includes(g[e].aptitudes[0])&&i++,this.selectedAptitudes.includes(g[e].aptitudes[1])&&i++,s.innerHTML=""+this.data.costs[l].cost[2-i][0],s.classList.add("m"+i),d.innerHTML=""+i,d.classList.add("m"+i),0===i&&n&&(t=!0)}if(t)continue;const l=document.createElement("div");m.appendChild(l),l.appendChild(s),l.appendChild(d);const i=document.createElement("div");i.innerHTML=g[e].name,l.appendChild(i);for(let t=0;t<g[e].aptitudes.length;t++){const n=document.createElement("div");n.innerHTML=g[e].aptitudes[t],this.selectedAptitudes.includes(g[e].aptitudes[t])&&n.classList.add("m2"),l.appendChild(n)}}$("[title]").tooltip()}exportAllTableToExcelDef(e,t,n){document.getElementById("exportTableToExcelDef")?.remove();const s=this.exportDivToTable(e),d=this.exportDivToTable(t),l=this.exportDivToTable(n);if(!s)return;if(!d)return;if(!l)return;const i=document.createElement("div");i.innerHTML="<table><tr><td>Characteristics</td></tr>\t<tr>\n\t\t<td>cost</td>\n\t\t<td>m</td>\n\t\t<td>skill</td>\n\t\t<td>aptitude</td>\n\t</tr>"+s.replace("<table>","").replace("</table>","")+"<tr><td> </td></tr><tr><td> </td></tr><tr><td>Skills</td></tr>\t<tr>\n\t\t<td>cost</td>\n\t\t<td>m</td>\n\t\t<td>characteristic</td>\n\t\t<td>aptitude</td>\n\t\t<td>aptitude</td>\n\t</tr>"+d.replace("<table>","").replace("</table>","")+"<tr><td> </td></tr><tr><td> </td></tr><tr><td>Talents</td></tr>\t<tr>\n\t\t<td>cost</td>\n\t\t<td>m</td>\n\t\t<td>tier</td>\n\t\t<td>talent</td>\n\t\t<td>aptitude</td>\n\t\t<td>aptitude</td>\n\t\t<td>requirement</td>\n\t\t<td>description</td>\n\t</tr>"+l.replace("<table>","").replace("</table>","")+"</table>",i.style.display="none",i.id="exportTableToExcelDef",document.body.appendChild(i),this.exportTableToExcel("exportTableToExcelDef","all")}exportTableToExcelDef(e){document.getElementById("exportTableToExcelDef")?.remove();const t=this.exportDivToTable(e);if(!t)return;const n=document.createElement("div");n.innerHTML=t,n.style.display="none",n.id="exportTableToExcelDef",document.body.appendChild(n),this.exportTableToExcel("exportTableToExcelDef",e)}exportDivToTable(e,t=!1){const n=document.getElementById(e);if(!n)return;let s="";t||(s+="<table>");for(let e=0;e<n.children.length;e++){t||(s+="<tr>");const d=n.children[e];for(let e=0;e<d.children.length;e++)t||(s+="<td>"),s+=d.children[e].innerHTML,s+=t?"\t":"</td>";s+=t?"\n":"</tr>"}return t||(s+="</table>"),s}exportTableToExcel(e,t=""){const n="application/vnd.ms-excel",s=document.getElementById(e);if(!s)return;const d=s.outerHTML.replace(/ /g,"%20");t=t?t+".xls":"excel_data.xls",document.getElementById("a789")?.remove();const l=document.createElement("a");if(l.id="a789",document.body.appendChild(l),navigator.msSaveOrOpenBlob){const e=new Blob(["\ufeff",d],{type:n});navigator.msSaveOrOpenBlob(e,t)}else l.href="data:"+n+", "+d,l.download=t,l.click()}copyToClipboard(e){const t=this.exportDivToTable(e,!0);if(!t)return;document.getElementById("textarea123")?.remove();const n=document.createElement("textarea");n.innerHTML=t,n.style.display="none",n.id="textarea123",document.body.appendChild(n),n.select(),n.setSelectionRange(0,99999),navigator.clipboard.writeText(n.value)}copyToClipboardWishlist(){const e=document.getElementById("talent");if(!e)return;let t="";for(let n=0;n<e.children.length;n++){const s=e.children[n];("0"==s.children[1].innerHTML||"1"==s.children[1].innerHTML)&&(t+=s.children[3].innerHTML+"\n")}document.getElementById("textarea456aa")?.remove();const n=document.createElement("textarea");n.innerHTML=t,n.style.display="none",n.id="textarea456aa",document.body.appendChild(n),n.select(),n.setSelectionRange(0,99999),console.log(n.value),navigator.clipboard.writeText(n.value)}aptitude(t){for(const n in e)if(t.replace("_","").replace(" ","")==n.replace("_","").replace(" ",""))return e[n];return null}logMatchingClasses(e,n){console.log("logMatchingClasses");const s=document.getElementById("aptitudeSelect");if(s.selectedIndex>=0){const e=s.selectedOptions,d=[],l=[];for(let t=0;t<e.length;t++){const n=this.data.optional[e[t].index];d.push(n)}console.log(d);for(let e=0;e<n.classes.length;e++){const s=n.classes[e];let i=0;for(let e=0;e<s.aptitudes.length;e++){const t=s.aptitudes[e];for(let e=0;e<d.length;e++)t==d[e]&&i++}const c=new t(s,i);l.push(c)}l.sort(((e,t)=>t.matches-e.matches));for(let e=0;e<l.length;e++)console.log(l[e].class?.class,l[e].matches,l[e].class?.aptitudes)}}}).init()}();
//# sourceMappingURL=w40k.js.map