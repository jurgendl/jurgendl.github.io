<!DOCTYPE html>
<html lang="en">
<!-- https://developer.snapappointments.com/bootstrap-select/ -->

<head>
  <!--<link rel="preconnect" href="https://fonts.gstatic.com">-->
  <!--<link rel="preload" href="https://fonts.gstatic.com/s/breeserif/v17/4UaHrEJCrhhnVA3DgluA96Tp56N1.woff2" as="font" type="font/woff2" crossorigin>-->
  <!--<link rel="preload" href="https://fonts.gstatic.com/s/breeserif/v17/4UaHrEJCrhhnVA3DgluA96rp5w.woff2" as="font" type="font/woff2" crossorigin>-->
  <!--<link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>-->
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>valheim-food</title>
  <meta http-equiv="Cache-Control" content="must-revalidate, max-age=86400" />
  <!--<meta http-equiv="Pragma" content="no-cache" />
	<meta http-equiv="Expires" content="0" />-->
  <!--<link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png">
	<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">-->
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <!--<link href="https://fonts.googleapis.com/css2?family=Bree+Serif&display=swap" rel="stylesheet">-->
  <!--<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">-->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <!--<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">-->
  <!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer" />-->
  <!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/11.0.2/css/bootstrap-slider.min.css" integrity="sha512-3q8fi8M0VS+X/3n64Ndpp6Bit7oXSiyCnzmlx6IDBLGlY5euFySyJ46RUlqIVs0DPCGOypqP8IRk/EyPvU28mQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />-->
  <!--<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">-->
  <link href="tabulator/css/tabulator.min.css" rel="stylesheet">
  <link href="tabulator/css/tabulator_bootstrap4.min.css" rel="stylesheet">
  <style id="internalcss">
    .tabulator .tabulator-header .tabulator-col .tabulator-col-content .tabulator-col-title {
      white-space: normal;
    }

    /*.full {
      position: absolute;
      height: 100vh;
      width: 100vw;
      top: 0;
      left: 0;
      padding: 100px 0 0 20px;
    }*/
  </style>
</head>

<!-- ============================================================================================================ -->
<!-- ============================================================================================================ -->

<body style="margin: 1em">

  <a href="https://valheim.fandom.com/wiki/Food" target="_blank">Wiki</a>
  <br><br>

  <div class="container">
    <div class="row">
      <div class="col-3">
        <input class="form-control form-control-sm" id="filter-name" type="text" placeholder="name">
      </div>
      <div class="col-3">
        <select class="form-control form-control-sm" id="filter-tier" placeholder="tier">
          <option value="" selected>select tier</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
        </select>
      </div>
      <div class="col-3">
        <input class="form-control form-control-sm" id="filter-hp" type="number" min="0" max="100" placeholder="hp">
      </div>
      <div class="col-3">
        <input class="form-control form-control-sm" id="filter-stamina" type="number" min="0" max="100" placeholder="sta">
      </div>
      <div class="col-3">
        <input class="form-control form-control-sm" id="filter-eitr" type="number" min="0" max="100" placeholder="eitr">
      </div>
      <div class="col-3">
        <select class="form-control form-control-sm" id="filter-type" placeholder="type">
          <option value="" selected>select type</option>
          <option value="W">white</option>
          <option value="Y">yellow</option>
          <option value="R">red</option>
          <option value="R">blue</option>
        </select>
      </div>
      <div class="col-3">
        <select class="form-control form-control-sm" id="filter-hps" placeholder="hps">
          <option value="" selected>select hp/s</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>
      </div>
      <div class="col-3">
        <select class="form-control form-control-sm" id="filter-duration" placeholder="duration">
          <option value="" selected>select duration in minutes</option>
          <option value="10">10</option>
          <option value="15">15</option>
          <option value="20">20</option>
          <option value="25">25</option>
          <option value="30">30</option>
        </select>
      </div>
      <div class="col-12 pt-1">
        <button class="btn btn-sm btn-primary" id="filter">Filter</button>
        <button class="btn btn-sm btn-secondary" id="filter-clear">Clear Filter</button>
      </div>
    </div>
  </div>
  <br>

  <div class="full no-thead-dark no-table-dark table-striped table-bordered table-sm" id="valheim-food-table"></div>

  <!-- ============================================================================================================ -->
  <!-- ============================================================================================================ -->

  <!--https://developer.snapappointments.com/bootstrap-select/examples/-->
  <script src=" https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
  <!-- <script src="https://cdn.jsdelivr.net/npm/p5@1.4.1/lib/p5.js"></script> -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF" crossorigin="anonymous"></script>
  <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
		crossorigin="anonymous"></script>-->
  <!--<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>-->
  <!-- https://bootstrap-confirmation.js.org/ -->
  <!-- https://github.com/mistic100/Bootstrap-Confirmation -->
  <!--<script src="https://cdn.jsdelivr.net/npm/bootstrap-confirmation2@4.1.0/dist/bootstrap-confirmation.min.js"></script>-->
  <!-- https://clipboardjs.com/ -->
  <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js"></script>-->
  <!-- https://github.com/seiyria/bootstrap-slider -->
  <!-- https://seiyria.com/bootstrap-slider/ -->
  <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/11.0.2/bootstrap-slider.min.js" integrity="sha512-f0VlzJbcEB6KiW8ZVtL+5HWPDyW1+nJEjguZ5IVnSQkvZbwBt2RfCBY0CBO1PsMAqxxrG4Di6TfsCPP3ZRwKpA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>-->
  <!-- https://developer.snapappointments.com/bootstrap-select/ -->
  <!-- https://github.com/snapappointments/bootstrap-select/ -->
  <!--<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>-->
  <!--<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/i18n/defaults-*.min.js"></script>-->

  <!--<script type="text/javascript" src="https://unpkg.com/tabulator-tables@5.4.3/dist/js/tabulator.min.js"></script>-->
  <script type="text/javascript" src="tabulator/js/tabulator.js"></script>

  <!--https://tabulator.info/docs/5.4/quickstart-->
  <!--https://tabulator.info/examples/5.4-->
  <!--https://tabulator.info/docs/5.4/filter#header-filters-->
  <script>
    function app(data) {
      window.localStorage.setItem('valheim-food', JSON.stringify(data));
      console.log(data);
      var tabledata = [];
      for (let [name, food] of Object.entries(data.food)) {
        var row = {
          id: food.id,
          name: food.name,
          tier: food.tier,
          starred: food.starred,// ? 'â˜…' : '',
          hp: food.hp,
          stamina: food.stamina,
          eitr: food.eitr,
          type: food.type.replace("white", "W").replace("yellow", "Y").replace("red", "R").replace("blue", "B"),
          hpPerSecond: food.hpPerSecond,
          durationInMinutes: food.durationInMinutes
        };
        for (let resource of data.resources) {
          if (food.resources[resource]) {
            row[resource] = food.resources[resource];
          } else {
            row[resource] = '';
          }
        }

        tabledata.push(row);
      }
      console.log(tabledata);
      console.table(tabledata);
      var resourceCols = [];
      for (let resource of data.resources) {
        resourceCols.push({ title: resource, field: resource, sorter: "number", headerVertical: true, hozAlign: "center" });
      }

      {
        var nameFilter = document.getElementById("filter-name");
        var tierFilter = document.getElementById("filter-tier");
        var typeFilter = document.getElementById("filter-type");
        var hpsFilter = document.getElementById("filter-hps");
        var durationInMinutesFilter = document.getElementById("filter-duration");
        var hpFilter = document.getElementById("filter-hp");
        var staminaFilter = document.getElementById("filter-stamina");
        var eitrFilter = document.getElementById("filter-eitr");
        function updateFilter() {
          table.clearFilter();
          var f = [];
          if (nameFilter.value) {
            f.push({ field: "name", type: "like", value: nameFilter.value });
          }
          if (tierFilter.value) {
            f.push({ field: "tier", type: "=", value: tierFilter.value });
          }
          if (typeFilter.value) {
            f.push({ field: "type", type: "=", value: typeFilter.value });
          }
          if (hpsFilter.value) {
            f.push({ field: "hpPerSecond", type: ">=", value: hpsFiles.value });
          }
          if (durationInMinutesFilter.value) {
            f.push({ field: "durationInMinutes", type: ">=", value: durationInMinutesFilter.value });
          }
          if (hpFilter.value) {
            f.push({ field: "hp", type: ">=", value: hpFilter.value });
          }
          if (staminaFilter.value) {
            f.push({ field: "stamina", type: ">=", value: staminaFilter.value });
          }
          if (eitrFilter.value) {
            f.push({ field: "eitr", type: ">=", value: eitrFilter.value });
          }
          if (f.length) {
            table.setFilter(f);
          }
        }
        document.getElementById("filter").addEventListener("click", function () {
          updateFilter();
        });
        document.getElementById("filter-clear").addEventListener("click", function () {
          nameFilter.value = "";
          tierFilter.value = "";
          typeFilter.value = "";
          hpsFilter.value = "";
          hpFilter.value = "";
          staminaFilter.value = "";
          eitrFilter.value = "";
          durationInMinutesFilter.value = "";
          table.clearFilter();
        });
      }

      var table = new Tabulator("#valheim-food-table", {
        placeholder: "Awaiting Data",
        height: '800', // set height of table (in CSS or here), this enables the Virtual DOM and improves render speed dramatically (can be any valid css height value)
        data: tabledata, //assign data to table
        //layout: "fitColumns", //fit columns to width of table (optional)
        //layout: "fitDataTable",
        //layoutColumnsOnNewData: true,
        // responsiveLayout:"hide", // hide rows that no longer fit
        // responsiveLayout:"collapse", // collapse columns that no longer fit on the table into a list under the row
        //resizableRows: true, // this option takes a boolean value (default = false)
        columns: [
          {
            title: "Name", field: "name", frozen: true, /*headerFilter: "input",*/ formatter: function (cell, formatterParams) {
              var value = cell.getValue();
              var tt = "";
              for (let [n, c] of Object.entries(data.food[value].resources)) {
                if (tt == "") {
                  tt = tt + c + " " + n;
                } else {
                  tt = tt + "\n" + c + " " + n;
                }
              }
              return '<div style="cursor:crosshair" title="' + tt + '">' + value + '</div>';
            }
          },
          {//create column group
            title: "Info", frozen: true,
            columns: [
              {
                title: "Tier", field: "tier", sorter: "number", headerVertical: true, hozAlign: "center" /*, headerFilter: "list", headerFilterParams: { valuesLookup: true, clearable: true }*/, formatter: function (cell, formatterParams) {
                  var value = cell.getValue();
                  if (value == 1) {
                    return "<span style='background-color:#e8f2a1;display:block;width:100%;height:100%'>" + value + "</span>";
                  } else if (value == 2) {
                    return "<span style='background-color:#bbe33d;display:block;width:100%;height:100%'>" + value + "</span>";
                  } else if (value == 3) {
                    return "<span style='background-color:#b4c7dc;display:block;width:100%;height:100%'>" + value + "</span>";
                  } else if (value == 4) {
                    return "<span style='background-color:#ddd;display:block;width:100%;height:100%'>" + value + "</span>";
                  } else if (value == 5) {
                    return "<span style='background-color:#ffdbb6;display:block;width:100%;height:100%'>" + value + "</span>";
                  } else if (value == 6) {
                    return "<span style='background-color:#ff6d6d;display:block;width:100%;height:100%'>" + value + "</span>";
                  } else {
                    return value;
                  }
                }
              },
              { title: "Starred", field: "starred", sorter: "boolean", headerVertical: true, hozAlign: "center", formatter: "tickCross"              /*, headerFilter: "tickCross", headerFilterParams: { "tristate": true }*/ },
              { title: "HP", field: "hp", sorter: "number", headerVertical: true, hozAlign: "center"/*, headerFilter: "number" */ },
              { title: "Stamina", field: "stamina", sorter: "number", headerVertical: true, hozAlign: "center"/*, headerFilter: "number"*/ },
              { title: "Eitr", field: "eitr", sorter: "number", headerVertical: true, hozAlign: "center"/*, headerFilter: "number"*/ },
              {
                title: "Type", field: "type", headerVertical: true, hozAlign: "center"/*, headerFilter: "list", headerFilterParams: { valuesLookup: true, clearable: true }*/, formatter: function (cell, formatterParams) {
                  var value = cell.getValue();
                  if (value == "Y") {
                    return "<span style='background-color:#ffff84;display:block;width:100%;height:100%'>Y</span>";
                  } else if (value == "R") {
                    return "<span style='background-color:#ff6d6d;display:block;width:100%;height:100%'>R</span>";
                  } else if (value == "B") {
                    return "<span style='background-color:#8787dc;display:block;width:100%;height:100%'>B</span>";
                  } else if (value == "W") {
                    return "<span style='background-color:#ddd;display:block;width:100%;height:100%'>W</span>";
                  } else {
                    return value;
                  }
                }
              },
              { title: "HP/s", field: "hpPerSecond", sorter: "number", headerVertical: true, hozAlign: "center", /*headerFilter: "list", headerFilterParams: { valuesLookup: true, clearable: true }*/ },
              { title: "Duration (m)", field: "durationInMinutes", sorter: "number", headerVertical: true, hozAlign: "center"/*, headerFilter: "number"*/ }
            ]
          },
          {//create column group
            title: "Resources",
            columns: resourceCols
          }
        ],
      });

      $(function () {
        setTimeout(() => {
          console.log('POST');
          $('[data-toggle="popover"]').popover({ trigger: 'focus' });

          for (let resource of data.resources) {
            var style = document.createElement("style");
            style.id = "style-" + resource;
            style.innerHTML = "[tabulator-field='" + resource + "'] { display: none !important; }";
            console.log(style.id, style.innerHTML);
            document.body.appendChild(style);
            document.getElementById("style-" + resource).disabled = true;
          }
        }, 3 * 1000);
      })
    }
    // https://developer.mozilla.org/en-US/docs/Web/API/Response/json
    // https://blog.logrocket.com/storing-retrieving-javascript-objects-localstorage/
    (() => {
      try {
        let valheimFood = window.localStorage.getItem('valheim-food');
        if (valheimFood && valheimFood != undefined && valheimFood != null) {
          let data = JSON.parse(valheimFood);
          console.log(data.headers);
          app(data);
        } else {
          fetch('valheim-food.json')
            .then((response) => response.json())
            .then((data) => app(data));
        }
      } catch (e) {
        console.log(e);
        fetch('valheim-food.json')
          .then((response) => response.json())
          .then((data) => app(data));
      }
    })();
  </script>

</body>

</html>